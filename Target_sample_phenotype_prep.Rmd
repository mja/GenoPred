---
title: "Training Sample Phenotype Preparation"
output: 
  html_document:
    toc: true
    theme: united
    toc_depth: 3
    number_sections: true
    toc_float: true
    fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error=TRUE)
```

<style>
p.caption {
  font-size: 1.5em;
}
</style>

```{css, echo=F}
pre code, pre, code {
  white-space: pre !important;
  overflow-x: auto !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}
```

***

To evaluate genotype-based prediction approaches, I am using a range of phenotypes measured in the UK Biobank and TEDS samples.

# UKBB

Phenotype:

* Depression
* Intelligence
* BMI
* Height
* CAD (Coronary artery disease)
* T2D (Type II diabetes)

Below I provide a description of how each phenotype was derived and some descriptive statistics.

```{R, echo=F, eval=F}
######
# Update file listing IDs after QC to match genetic data
######

source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')
library(data.table)
keep<-fread(qc_indiv_list)
fam<-fread(paste0(UKBB_output,'/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr22.fam'))

keep_fam<-merge(keep, fam, by=c('V2'))
keep_new<-keep_fam[,c('V1.y','V2'), with=F]

fwrite(keep_new, paste0(Results_dir,'/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam'), sep=' ', na='NA', col.names=F)
```

<br/>

***

## Depression
The depression phenotype was shared with my Kylie Glanville.

<details><summary>Preparation of Depression phenotype</summary>
```{r, echo=T, eval=F}
# Modify depression phenotype file so IDs match genotypic data
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')
library(data.table)
pheno<-fread(paste0(UKBB_output, '/Phenotype/Depression/ever_depressed_pheno_final.txt'))
fam<-fread(paste0(UKBB_output,'/UKBB/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr22.fam')
names(fam)[1:2]<-c('FID','IID')

pheno_fam<-merge(pheno, fam, by=c('IID'))
pheno_new<-pheno_fam[,c('FID.y','IID','Depressed.Ever.Clean'), with=F]
names(pheno_new)[1]<-'FID'

fwrite(pheno_new, paste0(UKBB_output,'/Phenotype/Depression/ever_depressed_pheno_final.UpdateIDs.txt'), sep=' ', na='NA')
```
</details>

<br/>

***

## Intelligence
The Intelligence phenotype is derived from the Fluid.intelligence.score.0.0 (f.20191.0.0) variable.

<details><summary>Preparation of Intelligence phenotype</summary>
```{r, echo=T, eval=F}
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')

# Read in the field finder to find he code for the phenotype of interest.
field_finder<-read.table(paste0(ukbb_pheno_file,'/ukb18177_glanville_field_finder.txt'), stringsAsFactors=F)
field_finder[grepl('Fluid.intelligence', field_finder$V3),]
# The Fluid intelligence variable has a code of f.20191.0.0 and is called Fluid.intelligence.score.0.0

# Identify which column in the phenotype file contains the relevant code
library(data.table)
pheno_header<-names(data.frame(fread(cmd=paste0('head -n 1 ',ukbb_pheno_file,'/ukb18177_glanville_phenotypes.txt'))))
rel_cols<-c(1,which(grepl('f.20191.0.0',pheno_header)))

# Read in the IID and fluid intelligence columns
pheno<-data.frame(fread(cmd=paste0('cut -f ',paste(rel_cols,collapse=','),' ',ukbb_pheno_file,'/ukb18177_glanville_phenotypes.txt')))
names(pheno)<-c('IID','Fluid.intelligence.score')

# Remove individuals with missing phenotype data
pheno<-pheno[complete.cases(pheno),]

# Calculate descriptive statistics for the phenotype
library(e1071)
descriptives<-data.frame(Phenotype='Fluid.intelligence.score',
                        Code='f.20127.0.0',
                        Mean=mean(pheno$Fluid.intelligence.score),
                        SD=sd(pheno$Fluid.intelligence.score),
                        Min=min(pheno$Fluid.intelligence.score),
                        Max=max(pheno$Fluid.intelligence.score),
                        Skewness=skewness(pheno$Fluid.intelligence.score),
                        N=dim(pheno)[1])

system(paste0('mkdir ',UKBB_output,'/Phenotype/Intelligence'))
write.table(descriptives,paste0(UKBB_output,'/Phenotype/Intelligence/Descriptives.txt'), row.names=F, quote=F)

# Plot the distribution
png(paste0(UKBB_output,'/Phenotype/Intelligence/Histogram.png'))
hist(pheno$Fluid.intelligence.score)
dev.off()

# Write out the phenotype in PLINK format.
pheno_plink<-data.frame(FID=pheno$IID,
                        IID=pheno$IID,
                        Fluid.intelligence.score=pheno$Fluid.intelligence.score)
                        
fwrite(pheno_plink, paste0(UKBB_output,'/Phenotype/Intelligence/UKBB_Fluid.intelligence.score.pheno'), sep='\t')
```
</details>

```{bash, echo=F, eval=T}
# Set variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config

mkdir -p /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/Intelligence

cp ${UKBB_output}/Phenotype/Intelligence/Histogram.png /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/Intelligence/
```

<details><summary>Descriptives of Intelligence phenotype</summary>

<center>

![Figure 1: Distribution of Intelligence in UK Biobank](/users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/Intelligence/Histogram.png)

\center

<br/>

***

```{r, echo=F, eval=T, results='asis'}
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')
desc<-read.table(paste0(UKBB_output,'/Phenotype/Intelligence/Descriptives.txt'), header=T)
desc$Mean<-round(desc$Mean,3)
desc$SD<-round(desc$SD,3)
desc$Min<-round(desc$Min,3)
desc$Max<-round(desc$Max,3)
desc$Skewness<-round(desc$Skewness,3)
desc$N<-round(desc$N,3)

library(knitr)
kable(desc, row.names = FALSE, caption='Table 1: Descriptives of Intelligence in UK Biobank')
```

</details>

<br/>

***

## Height
The Height phenotype is derived from the Standing.height.0.0 (f.50.0.0) variable.

<details><summary>Preparation of Intelligence phenotype</summary>
```{r, echo=T, eval=F}
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')

# Read in the field finder to find he code for the phenotype of interest.
field_finder<-read.table(paste0(ukbb_pheno_file,'/ukb18177_glanville_field_finder.txt'), stringsAsFactors=F)
field_finder[grepl('height', field_finder$V3),]
# The best height variable has a code of f.50.0.0 and is called Standing.height.0.0

# Identify which column in the phenotype file contains the relevant code
library(data.table)
pheno_header<-names(data.frame(fread(cmd=paste0('head -n 1 ',ukbb_pheno_file,'/ukb18177_glanville_phenotypes.txt'))))
rel_cols<-c(1,which(grepl('f.50.0.0',pheno_header)))

# Read in the IID and fluid intelligence columns
pheno<-data.frame(fread(cmd=paste0('cut -f ',paste(rel_cols,collapse=','),' ',ukbb_pheno_file,'/ukb18177_glanville_phenotypes.txt')))
names(pheno)<-c('IID','Height')

# Remove individuals with missing phenotype data
pheno<-pheno[complete.cases(pheno),]

# Calculate descriptive statistics for the phenotype
library(e1071)
descriptives<-data.frame(Phenotype='Standing.height.0.0',
                        Code='f.50.0.0',
                        Mean=mean(pheno$Height),
                        SD=sd(pheno$Height),
                        Min=min(pheno$Height),
                        Max=max(pheno$Height),
                        Skewness=skewness(pheno$Height),
                        N=dim(pheno)[1])

system(paste0('mkdir ',UKBB_output,'/Phenotype/Height'))
write.table(descriptives,paste0(UKBB_output,'/Phenotype/Height/Descriptives.txt'), row.names=F, quote=F)

# Plot the distribution
png(paste0(UKBB_output,'/Phenotype/Height/Histogram.png'))
hist(pheno$Height)
dev.off()

# Remove outliers
pheno_no_outlier<-pheno[(pheno$Height < mean(pheno$Height)+(3*sd(pheno$Height))) & (pheno$Height > mean(pheno$Height)-(3*sd(pheno$Height))),]

# Plot the distribution
png(paste0(UKBB_output,'/Phenotype/Height/Histogram_noOutlier.png'))
hist(pheno_no_outlier$Height)
dev.off()

# Write out the phenotype in PLINK format.
pheno_plink<-data.frame(FID=pheno_no_outlier$IID,
                        IID=pheno_no_outlier$IID,
                        Height=pheno_no_outlier$Height)
                        
fwrite(pheno_plink, paste0(UKBB_output,'/Phenotype/Height/UKBB_Height.pheno'), sep='\t')
```
</details>

```{bash, echo=F, eval=T}
# Set variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config

mkdir -p /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/Height

cp ${UKBB_output}/Phenotype/Height/Histogram.png /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/Height/
cp ${UKBB_output}/Phenotype/Height/Histogram_noOutlier.png /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/Height/
```

<details><summary>Descriptives of Height phenotype</summary>

<center>

![Figure 2: Distribution of Height in UK Biobank](/users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/Height/Histogram.png)

![Figure 3: Distribution of Height in UK Biobank after removal of outliers](/users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/Height/Histogram_noOutlier.png)

\center

<br/>

***

```{r, echo=F, eval=T, results='asis'}
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')
desc<-read.table(paste0(UKBB_output,'/Phenotype/Height/Descriptives.txt'), header=T)
desc$Mean<-round(desc$Mean,3)
desc$SD<-round(desc$SD,3)
desc$Min<-round(desc$Min,3)
desc$Max<-round(desc$Max,3)
desc$Skewness<-round(desc$Skewness,3)
desc$N<-round(desc$N,3)

library(knitr)
kable(desc, row.names = FALSE, caption='Table 1: Descriptives of Height in UK Biobank')
```

</details>

<br/>

***

## BMI
The BMI phenotype is derived from the Body.mass.index.BMI.0.0 (f.21001.0.0) variable.

<details><summary>Preparation of BMI phenotype</summary>
```{r, echo=T, eval=F}
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')

# Read in the field finder to find he code for the phenotype of interest.
field_finder<-read.table(paste0(ukbb_pheno_file,'/ukb18177_glanville_field_finder.txt'), stringsAsFactors=F)
field_finder[grepl('bmi', field_finder$V3),]
# The best height variable has a code of f.21001.0.0 and is called Body.mass.index.BMI.0.0

# Identify which column in the phenotype file contains the relevant code
library(data.table)
pheno_header<-names(data.frame(fread(cmd=paste0('head -n 1 ',ukbb_pheno_file,'/ukb18177_glanville_phenotypes.txt'))))
rel_cols<-c(1,which(grepl('f.21001.0.0',pheno_header)))

# Read in the IID and fluid intelligence columns
pheno<-data.frame(fread(cmd=paste0('cut -f ',paste(rel_cols,collapse=','),' ',ukbb_pheno_file,'/ukb18177_glanville_phenotypes.txt')))
names(pheno)<-c('IID','BMI')

# Remove individuals with missing phenotype data
pheno<-pheno[complete.cases(pheno),]

# Calculate descriptive statistics for the phenotype
library(e1071)
descriptives<-data.frame(Phenotype='Body.mass.index.BMI.0.0',
                        Code='f.50.0.0',
                        Mean=mean(pheno$BMI),
                        SD=sd(pheno$BMI),
                        Min=min(pheno$BMI),
                        Max=max(pheno$BMI),
                        Skewness=skewness(pheno$BMI),
                        N=dim(pheno)[1])

system(paste0('mkdir ',UKBB_output,'/Phenotype/BMI'))
write.table(descriptives,paste0(UKBB_output,'/Phenotype/BMI/Descriptives.txt'), row.names=F, quote=F)

# Plot the distribution
png(paste0(UKBB_output,'/Phenotype/BMI/Histogram.png'))
hist(pheno$BMI)
dev.off()

# Remove outliers
pheno_no_outlier<-pheno[(pheno$BMI < mean(pheno$BMI)+(3*sd(pheno$BMI))) & (pheno$BMI > mean(pheno$BMI)-(3*sd(pheno$BMI))),]

# Plot the distribution
png(paste0(UKBB_output,'/Phenotype/BMI/Histogram_noOutlier.png'))
hist(pheno_no_outlier$BMI)
dev.off()

# Write out the phenotype in PLINK format.
pheno_plink<-data.frame(FID=pheno_no_outlier$IID,
                        IID=pheno_no_outlier$IID,
                        BMI=pheno_no_outlier$BMI)
                        
fwrite(pheno_plink, paste0(UKBB_output,'/Phenotype/BMI/UKBB_BMI.pheno'), sep='\t')
```

</details>

```{bash, echo=F, eval=T}
# Set variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config

mkdir -p /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/BMI

cp ${UKBB_output}/Phenotype/BMI/Histogram.png /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/BMI/
cp ${UKBB_output}/Phenotype/BMI/Histogram_noOutlier.png /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/BMI/
```

<details><summary>Descriptives of BMI phenotype</summary>

<center>

![Figure 4: Distribution of BMI in UK Biobank](/users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/BMI/Histogram.png)

![Figure 5: Distribution of BMI in UK Biobank after removal of outliers](/users/k1806347/brc_scratch/Software/MyGit/GenoPred/Images/Target_sample_phenotype_prep/BMI/Histogram_noOutlier.png)

\center

<br/>

***

```{r, echo=F, eval=T, results='asis'}
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')
desc<-read.table(paste0(UKBB_output,'/Phenotype/BMI/Descriptives.txt'), header=T)
desc$Mean<-round(desc$Mean,3)
desc$SD<-round(desc$SD,3)
desc$Min<-round(desc$Min,3)
desc$Max<-round(desc$Max,3)
desc$Skewness<-round(desc$Skewness,3)
desc$N<-round(desc$N,3)

library(knitr)
kable(desc, row.names = FALSE, caption='Table 1: Descriptives of BMI in UK Biobank')
```

</details>

<br/>

## CAD

<details><summary>Preparation of CAD phenotype from Saskia</summary>
```{r, echo=T, eval=F}
# Modify depression phenotype file so IDs match genotypic datad
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')
library(data.table)
pheno<-fread(paste0(UKBB_output, '/Phenotype/CAD/cad_only_111119.txt'))
names(pheno)[1]<-'IID'
fam<-fread(paste0(UKBB_output,'/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr22.fam'))
names(fam)[1:2]<-c('FID','IID')

pheno_fam<-merge(pheno, fam, by=c('IID'))
pheno_new<-pheno_fam[,c('FID','IID','CAD_all'), with=F]

fwrite(pheno_new, paste0(UKBB_output,'/Phenotype/CAD/cad_only_111119.UpdateIDs.txt'), sep=' ', na='NA')
```
</details>

## Type-2 Diabetes (T2D)
T2D phenotypes were shared by Saskia Hagenaars

<details><summary>Preparation of T2D phenotype</summary>
```{r, echo=T, eval=F}
# Modify depression phenotype file so IDs match genotypic data
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')
library(data.table)
pheno<-fread(paste0(UKBB_output, '/Phenotype/T2D/t2d_only_111119.txt'))
names(pheno)[1]<-'IID'
fam<-fread(paste0(UKBB_output,'/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr22.fam'))
names(fam)[1:2]<-c('FID','IID')

pheno_fam<-merge(pheno, fam, by=c('IID'))
pheno_new<-pheno_fam[,c('FID','IID','t2d_all'), with=F]

fwrite(pheno_new, paste0(UKBB_output,'/Phenotype/T2D/t2d_only_111119.UpdateIDs.txt'), sep=' ', na='NA')
```
</details>

<br/>

# TEDS

Phenotypes:

* BMI (age 21)
* Height (age 21)
* GCSE scores
* ADHD traits (age 12)

<details><summary>Preparation of TEDS phenotype</summary>

```{bash, eval=F}
################################################################
# Prepare phenotypes in TEDS for prediction
################################################################

module add general/R/3.5.0
R
source('/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config')

#########
# Read in the TEDS data
#########

library(foreign)

pheno<-read.spss(paste0(TEDS_output_dir,'/Phenotypic/data_recieved/399\ Oliver\ Pain\ GERS\ 060319.sav'),to.data.frame=T)

#########
# Rename required variables to match Saskia's script
#########

x<-data.frame(	FID=pheno$id_fam,
				IID=pheno$id_twin,
				twin=pheno$twin,
				sex1=pheno$sex1,
				sex2=pheno$sex2,
				age12par=pheno$lpqage,
				SDQhyp_par12_1=pheno$lpshypt1,
				SDQhyp_par12_2=pheno$lpshypt2,
				Con_ADHD12_par_1=pheno$lpconnt1,
				Con_ADHD12_par_2=pheno$lpconnt2,
				age16par=pheno$ppbhage,
				SDQhyp_par16_1=pheno$ppbhsdqhypt1,
				SDQhyp_par16_2=pheno$ppbhsdqhypt2,
				Con_ADHD16_par16_1=pheno$ppbhconnt1,
				Con_ADHD16_par16_2=pheno$ppbhconnt2,
				GCSEage=pheno$pcexgcseage1,
				GCSE_1=pheno$pcexgcsecorem1,
				GCSE_2=pheno$pcexgcsecorem2,
				Weight21_1=pheno$u1cwtkg1,
				Weight21_2=pheno$u1cwtkg2,
				Height21_1=pheno$u1chtcm1,
				Height21_2=pheno$u1chtcm2,
				age21_1=pheno$u1cage1,
				age21_2=pheno$u1cage2)

#########
# Create BMI variable
#########

x$BMI21_1 		<- x$Weight21_1/((x$Height21_1/100)^2)
x$BMI21_2 		<- x$Weight21_2/((x$Height21_2/100)^2)

#########
# Create ADHD symptom score variable
#########

#create age regressed mean scores of SDZ & ADHD parent ratings at age 12 & 16
#ADHD as the mean of parent reported SDZ & Connors scores
#set function to create cleaned age specific ADHD variable
zresid <- 	function(x,y,age) {
					scale(
						resid(
							lm(
								((scale(x)+scale(y))/2)~age,na.action=na.exclude
							)
						)
					)
				}		


#create age regressed mean scores of SDZ & ADHD parent ratings at age 12 & 16
x$ADHD12_1 		<- zresid(x=x$SDQhyp_par12_1,y=x$Con_ADHD12_par_1,age=x$age12par)
x$ADHD12_2 		<- zresid(x=x$SDQhyp_par12_2,y=x$Con_ADHD12_par_2,age=x$age12par)

x$ADHD16_1 		<- zresid(x=x$SDQhyp_par16_1,y=x$Con_ADHD16_par16_1,age=x$age16par)
x$ADHD16_2 		<- zresid(x=x$SDQhyp_par16_2,y=x$Con_ADHD16_par16_2,age=x$age16par)

#create ADHD mean score. If both age 12 & 16 available, take mean, if 16 is missing use 12 only and vice versa
x$ADHD_1 			<- ifelse((!is.na(x$ADHD12_1) & !is.na(x$ADHD16_1)),  
								(x$ADHD12_1+x$ADHD16_1)/2,
						ifelse(is.na(x$ADHD12_1),x$ADHD16_1,
							ifelse(is.na(x$ADHD16_1), x$ADHD12_1, NA
							) 
						)
					)	

x$ADHD_2 			<- ifelse((!is.na(x$ADHD12_2) & !is.na(x$ADHD16_2)),  
								(x$ADHD12_2+x$ADHD16_2)/2,
						ifelse(is.na(x$ADHD12_2),x$ADHD16_2,
							ifelse(is.na(x$ADHD16_2), x$ADHD12_2, NA
							) 
						)
					)	

#create ADHD age variables for longitudinal measures, which is age 16 centered
x$ADHD_AGE_1 			<- ifelse((!is.na(x$ADHD12_1) & !is.na(x$ADHD16_1)),  
									x$age16par-16,
								ifelse(is.na(x$ADHD12_1),x$age16par-16,
									ifelse(is.na(x$ADHD16_1), x$age12par-16, NA
								) 
							)
						)	


x$ADHD_AGE_2 			<- ifelse((!is.na(x$ADHD12_2) & !is.na(x$ADHD16_2)),  
									x$age16par-16,
								ifelse(is.na(x$ADHD12_2),x$age16par-16,
									ifelse(is.na(x$ADHD16_2), x$age12par-16, NA
								) 
							)
						)	

#########
# Now regress out sex (and age if necessary)
#########

x$clHeight21_1 <- rstandard(lm(Height21_1~sex1+age21_1,data=x,na.action=na.exclude))
x$clHeight21_2 <- rstandard(lm(Height21_2~sex2+age21_2,data=x,na.action=na.exclude))
x$clBMI21_1 <- rstandard(lm(BMI21_1~sex1+age21_1,data=x,na.action=na.exclude))
x$clBMI21_2 <- rstandard(lm(BMI21_2~sex2+age21_2,data=x,na.action=na.exclude))
x$clGCSE_1 <- rstandard(lm(GCSE_1~sex1+GCSEage,data=x,na.action=na.exclude))
x$clGCSE_2 <- rstandard(lm(GCSE_2~sex2+GCSEage,data=x,na.action=na.exclude))
x$clADHD_1 <- rstandard(lm(ADHD_1~sex1+ADHD_AGE_1,data=x,na.action=na.exclude))
x$clADHD_2 <- rstandard(lm(ADHD_2~sex2+ADHD_AGE_2,data=x,na.action=na.exclude))

#########
# Create files containing each phenotype with unrelated individuals only
#########

# Make function that randomly removes duplicates
duplicated.random = function(x, incomparables = FALSE, ...) 
{ 
     if ( is.vector(x) ) 
     { 
         permutation = sample(length(x)) 
         x.perm      = x[permutation] 
         result.perm = duplicated(x.perm, incomparables, ...) 
         result      = result.perm[order(permutation)] 
         return(result) 
     } 
     else if ( is.matrix(x) ) 
     { 
         permutation = sample(nrow(x)) 
         x.perm      = x[permutation,] 
         result.perm = duplicated(x.perm, incomparables, ...) 
         result      = result.perm[order(permutation)] 
         return(result) 
     } 
     else 
     { 
         stop(paste("duplicated.random() only supports vectors", 
                "matrices for now.")) 
     } 
} 

for(outcome in c('Height21','BMI21','GCSE','ADHD')){
	tmp<-x[c('FID','IID',paste0('cl',outcome,'_1'))]
	tmp<-tmp[complete.cases(tmp),]
	set.seed(1)
	tmp<-tmp[!duplicated.random(tmp$FID),]
	names(tmp)<-c('FID','IID',outcome)
	
	write.table(tmp, paste0(TEDS_output_dir,/Phenotypic/Derived_outcomes/TEDS_',outcome,'.txt'), col.names=T, row.names=F, quote=F)
}

q()
n
```

</details>

<br/>
