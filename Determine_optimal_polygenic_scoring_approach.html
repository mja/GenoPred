<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Comparison of polygenic scoring methods</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">GenoPred</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/opain/GenoPred">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Comparison of polygenic scoring methods</h1>

</div>


<style>
p.caption {
  font-size: 1.5em;
}
</style>
<style type="text/css">
pre code, pre, code {
  white-space: pre !important;
  overflow-x: scroll !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}
</style>
<hr />
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>There are two main approaches for calculating polygenic scores (PRSs):</p>
<ul>
<li><em>p</em>-value thresholding and clumping</li>
<li>Shrinkage of GWAS summary statistics</li>
<li>Best-Linear Unbiased Predictor (BLUP)</li>
</ul>
<p>We often don’t know what the optimal parameters are when deriving a polygenic score, i.e. best p-value threshold or best shrinkage parameters. Methods to identify the best parameter are:</p>
<ul>
<li>Cross-validation (e.g. 10-fold cross validation).
<ul>
<li>Will find optimal parameters, however is time consuming.</li>
</ul></li>
<li>Pseudo-validation - optimal parameters are predicted based on distribution of GWAS summary statistics.
<ul>
<li>Fast but may not find optimal threshold.</li>
</ul></li>
</ul>
<p>Rather than using a single PRS, it may also be advantageous to predict outcome using multiple PRSs based on different parameters. A limitation to this approach is that modelling many predictors is computationally intensive and may increase the risk of overfitting.</p>
<p>Another approach for improving prediction using polygenic scores is to model polygenic scores for multiple outcomes in an elastic net model (<a href="https://www.nature.com/articles/mp2017163">ref</a>,<a href="https://www.nature.com/articles/s41380-019-0394-4">ref</a>). Here we will aim to replicate these findings with the polygenic score method that this study determines as optimal.</p>
<p><br/></p>
<hr />
</div>
<div id="aims" class="section level1">
<h1><span class="header-section-number">2</span> Aims</h1>
<ol style="list-style-type: decimal">
<li>Compare PRS derived from p-value and clumping method, shrinkage methods (including lassosum and PRScs), and S-BLUP, using 10-fold cross validation to identify the optimal parameters.</li>
<li>Compare the predictive utility of the best PRS identified using 10-fold cross-validated PRS with the PRS selected using pseudo-validation.</li>
<li>Compare predictive utility of models including multiple PRSs based on difference parameters, to those using a single PRS selected using 10-fold cross-validation or pseudo-validation.</li>
<li>Test whether models containing polygenic scores for multiple outcomes improve prediction over the use of a polygenic score for a single outcome.</li>
</ol>
<p><br/></p>
<hr />
</div>
<div id="methods" class="section level1">
<h1><span class="header-section-number">3</span> Methods</h1>
<div id="samples" class="section level2">
<h2><span class="header-section-number">3.1</span> Samples</h2>
<ul>
<li>UK Biobank</li>
<li>TEDS</li>
</ul>
</div>
<div id="outcomes" class="section level2">
<h2><span class="header-section-number">3.2</span> Outcomes</h2>
<ul>
<li>UK Biobank
<ul>
<li>Depression (binary)</li>
<li>Intelligence (continuous)</li>
<li>Body mass index (BMI - continuous)</li>
<li>Height (continuous)</li>
<li>Coronary Artery Disease (CAD - Binary)</li>
<li>Type II Diabetes (T2D - Binary)</li>
<li>Inflammatory Bowel Disorder (IBD - Binary)</li>
<li>Rheumatoid arthritis (RheuArth - Binary)</li>
<li>Multiple Slerosis (MultiScler - Binary)</li>
</ul></li>
<li>TEDS
<ul>
<li>ADHD traits (continuous)</li>
<li>Height (continuous)</li>
<li>Body mass index (BMI - continuous)</li>
<li>GCSE scores (continuous)</li>
</ul></li>
</ul>
</div>
<div id="genotypic-data" class="section level2">
<h2><span class="header-section-number">3.3</span> Genotypic data</h2>
<p>HapMap3 variants were extracted from the HRC imputed genetic data, and converted to hard-call PLINK format with no hard-call threshold to maximise overlap with the HapMap3 SNP list. Individuals were excluded if they had extensive missing data, had non-European ancestry, or were closely-related to other individuals in the sample. This was done prior to this project.</p>
</div>
<div id="polygenic-scoring" class="section level2">
<h2><span class="header-section-number">3.4</span> Polygenic scoring</h2>
<p>Polygenic scores were derived using three methods: 1. p-value thresholding and clumping (pT + clump). No pseudo-validation approach for selecting the optimal pT is available). Both sparse (8 pTs) and dense (500 pTs) will be tested. 2. lassosum - Lasso-based shrinkage method. 3. PRScs - Bayesian shrinkage method. 3. SBLUP - Summary statistic-based BLUP estimates</p>
<p>Polygenic scores were derived using a reference standardised pipeline, previously described in detail <a href="https://opain.github.io/GenoPred/Pipeline_prep.html#4_polygenic_scoring">here</a>. In brief, all scores were derived using HapMap3 SNPs only, modelling LD based on European individuals within the 1000 Genomes reference. Any HapMap3 missing in the target sample are imputed using the allele frequency measured in the European subset of the 1000 Genomes reference.</p>
<div id="uk-biobank" class="section level3">
<h3><span class="header-section-number">3.4.1</span> UK Biobank</h3>
<div id="pt-clump-sparse" class="section level4">
<h4><span class="header-section-number">3.4.1.1</span> pT + clump sparse</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Create variable listing phenotypes and corresponding GWAS
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

# Create directory for PRS
mkdir -p ${UKBB_output}/users/k1806347/brc_scratch/Data/UKBB/PRS_for_comparison/1KG_ref/pt_clump

# Calculate polygenic scores
for i in $(seq 1 9);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

  qsub /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer/Scaled_polygenic_scorer.R \
    --target_plink_chr ${UKBB_output}/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr \
    --target_keep ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic/${gwas_i}/1KGPhase3.w_hm3.${gwas_i} \
    --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic/${gwas_i}/1KGPhase3.w_hm3.${gwas_i}.EUR.scale \
    --ref_freq_chr ${Geno_1KG_dir}/freq_files/EUR/1KGPhase3.w_hm3.EUR.chr \
    --plink ${plink1_9} \
    --pheno_name ${gwas_i} \
    --output ${UKBB_output}/PRS_for_comparison/1KG_ref/pt_clump/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}
    
done</code></pre>
</details>
</div>
<div id="pt-clump-dense" class="section level4">
<h4><span class="header-section-number">3.4.1.2</span> pT + clump dense</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Create variable listing phenotypes and corresponding GWAS
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

# Create directory for PRS
mkdir -p ${UKBB_output}/users/k1806347/brc_scratch/Data/UKBB/PRS_for_comparison/1KG_ref/pt_clump_dense

# Calculate polygenic scores
n=0
for i in $(seq 2 9);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  
  qsub -N $(echo PRS_job$(($n+50))) -hold_jid $(echo PRS_job$(($n+0))) /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer_dense/Scaled_polygenic_scorer_dense.R \
    --target_plink_chr ${UKBB_output}/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr \
    --target_keep ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic_dense/${gwas_i}/1KGPhase3.w_hm3.${gwas_i}.GWAS_sumstats_clumped.txt \
    --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_dense/${gwas_i}/1KGPhase3.w_hm3.${gwas_i}.EUR.scale \
    --prsice_path ${prsice_path} \
    --rscript ${rscript} \
    --pheno_name ${gwas_i} \
    --output ${UKBB_output}/PRS_for_comparison/1KG_ref/pt_clump_dense/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}

    n=$(($n+1))
done</code></pre>
</details>
<p><br/></p>
</div>
<div id="pt-clump-sparse-non-nested" class="section level4">
<h4><span class="header-section-number">3.4.1.3</span> pT + clump sparse (non-nested)</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Create variable listing phenotypes and corresponding GWAS
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

# Create directory for PRS
mkdir -p ${UKBB_output}/users/k1806347/brc_scratch/Data/UKBB/PRS_for_comparison/1KG_ref/pt_clump

# Calculate polygenic scores
for i in $(seq 1 9);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

  qsub -N non_nested /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer/Scaled_polygenic_scorer.R \
    --target_plink_chr ${UKBB_output}/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr \
    --target_keep ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic_non_nested/${gwas_i}/1KGPhase3.w_hm3.${gwas_i} \
    --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_non_nested/${gwas_i}/1KGPhase3.w_hm3.${gwas_i}.EUR.scale \
    --ref_freq_chr ${Geno_1KG_dir}/freq_files/EUR/1KGPhase3.w_hm3.EUR.chr \
    --plink ${plink1_9} \
    --pheno_name ${gwas_i} \
    --output ${UKBB_output}/PRS_for_comparison/1KG_ref/pt_clump_non_nested/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}
    
done</code></pre>
</details>
<p><br/></p>
</div>
<div id="lassosum" class="section level4">
<h4><span class="header-section-number">3.4.1.4</span> lassosum</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Create variable listing phenotypes and corresponding GWAS
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

# Create directory for PRS
mkdir -p ${UKBB_output}/users/k1806347/brc_scratch/Data/UKBB/PRS_for_comparison/1KG_ref/lassosum

# Calculate polygenic scores
for i in $(seq 1 9);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  
  qsub -N lassosum -pe smp 6 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer_lassosum/Scaled_polygenic_scorer_lassosum.R \
    --target_plink_chr ${UKBB_output}/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr \
    --target_keep ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --ref_model ${Geno_1KG_dir}/Score_files_for_poylygenic_lassosum/${gwas_i}/1KGPhase3.w_hm3.${gwas_i}.unvalidated.model.RDS \
    --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_lassosum/${gwas_i}/1KGPhase3.w_hm3.${gwas_i}.EUR.scale \
    --pheno_name ${gwas_i} \
    --n_cores 6 \
    --output ${UKBB_output}/PRS_for_comparison/1KG_ref/lassosum/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}
    
done</code></pre>
</details>
<p><br/></p>
</div>
<div id="prscs" class="section level4">
<h4><span class="header-section-number">3.4.1.5</span> PRScs</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Create variable listing phenotypes and corresponding GWAS
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

# Create directory for PRS
mkdir -p ${UKBB_output}/users/k1806347/brc_scratch/Data/UKBB/PRS_for_comparison/1KG_ref/PRScs

# Calculate polygenic scores
for i in $(seq 1 9);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

  qsub -N PRScs /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer_PRScs/Scaled_polygenic_scorer_PRScs.R \
    --target_plink_chr ${UKBB_output}/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr \
    --target_keep ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic_PRScs/${gwas_i}/1KGPhase3.w_hm3.${gwas_i} \
    --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_PRScs/${gwas_i}/1KGPhase3.w_hm3.${gwas_i}.EUR.scale \
    --ref_freq_chr ${Geno_1KG_dir}/freq_files/EUR/1KGPhase3.w_hm3.EUR.chr \
    --plink ${plink1_9} \
    --pheno_name ${gwas_i} \
    --output ${UKBB_output}/PRS_for_comparison/1KG_ref/PRScs/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}
    
done</code></pre>
</details>
<p><br/></p>
</div>
<div id="sblup" class="section level4">
<h4><span class="header-section-number">3.4.1.6</span> SBLUP</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Create variable listing phenotypes and corresponding GWAS
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

# Create directory for PRS
mkdir -p ${UKBB_output}/users/k1806347/brc_scratch/Data/UKBB/PRS_for_comparison/1KG_ref/SBLUP

# Calculate polygenic scores
for i in $(seq 1 9);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

  qsub -N SBLUP /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer_SBLUP/Scaled_polygenic_scorer_SBLUP.R \
    --target_plink_chr ${UKBB_output}/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr \
    --target_keep ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic_SBLUP/${gwas_i}/GWAS_sumstats_SBLUP.sblup.cojo \
    --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_SBLUP/${gwas_i}/1KGPhase3.w_hm3.${gwas_i}.EUR.scale \
    --ref_freq_chr ${Geno_1KG_dir}/freq_files/EUR/1KGPhase3.w_hm3.EUR.chr \
    --plink ${plink1_9} \
    --pheno_name ${gwas_i} \
    --output ${UKBB_output}/PRS_for_comparison/1KG_ref/SBLUP/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}
    
done</code></pre>
</details>
<p><br/></p>
</div>
</div>
<div id="teds" class="section level3">
<h3><span class="header-section-number">3.4.2</span> TEDS</h3>
<div id="pt-clump-sparse-1" class="section level4">
<h4><span class="header-section-number">3.4.2.1</span> pT + clump sparse</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

mkdir -p ${TEDS_output_dir}/PolygenicScores/EUR

# Calculate polygenic scores for for Europeans only for now.
n=0
for gwas in $(echo HEIG03 EDUC03 ADHD04 BODY11);do
qsub -N $(echo PRS_job$(($n+50))) -hold_jid $(echo PRS_job$(($n+0))) /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer/Scaled_polygenic_scorer.R \
  --target_plink_chr ${TEDS_output_dir}/Genotype/Harmonised/TEDS.w_hm3.QCd.AllSNP.chr \
    --target_keep ${TEDS_output_dir}/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
  --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic/${gwas}/1KGPhase3.w_hm3.${gwas} \
  --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic/${gwas}/1KGPhase3.w_hm3.${gwas}.EUR.scale \
  --ref_freq_chr ${Geno_1KG_dir}/freq_files/EUR/1KGPhase3.w_hm3.EUR.chr \
  --plink ${plink1_9} \
  --pheno_name ${gwas} \
  --output ${TEDS_output_dir}/PolygenicScores/EUR/${gwas}/TEDS.w_hm3.${gwas}.EUR
n=$(($n+1))
done</code></pre>
</details>
<p><br/></p>
</div>
<div id="pt-clump-dense-1" class="section level4">
<h4><span class="header-section-number">3.4.2.2</span> pT + clump dense</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Calculate polygenic scores for for Europeans only for now.
for gwas in $(echo HEIG03 EDUC03 ADHD04 BODY11);do
qsub -N PRS_dense /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer_dense/Scaled_polygenic_scorer_dense.R \
  --target_plink_chr ${TEDS_output_dir}/Genotype/Harmonised/TEDS.w_hm3.QCd.AllSNP.chr \
    --target_keep ${TEDS_output_dir}/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
  --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic_dense/${gwas}/1KGPhase3.w_hm3.${gwas}.GWAS_sumstats_clumped.txt \
  --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_dense/${gwas}/1KGPhase3.w_hm3.${gwas}.EUR.scale \
  --prsice_path ${prsice_path} \
  --rscript ${rscript} \
  --pheno_name ${gwas} \
  --output ${TEDS_output_dir}/PolygenicScores_dense/EUR/${gwas}/TEDS.w_hm3.${gwas}.EUR
done
</code></pre>
</details>
<p><br/></p>
</div>
<div id="pt-clump-sparse-non-nested-1" class="section level4">
<h4><span class="header-section-number">3.4.2.3</span> pT + clump sparse (non-nested)</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

mkdir -p ${TEDS_output_dir}/PolygenicScores_non_nested/EUR

# Calculate polygenic scores for for Europeans only for now.
n=0
for gwas in $(echo HEIG03 EDUC03 ADHD04 BODY11);do
qsub -N $(echo PRS_job$(($n+50))) -hold_jid $(echo PRS_job$(($n+0))) /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer/Scaled_polygenic_scorer.R \
  --target_plink_chr ${TEDS_output_dir}/Genotype/Harmonised/TEDS.w_hm3.QCd.AllSNP.chr \
    --target_keep ${TEDS_output_dir}/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
  --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic_non_nested/${gwas}/1KGPhase3.w_hm3.${gwas} \
  --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_non_nested/${gwas}/1KGPhase3.w_hm3.${gwas}.EUR.scale \
  --ref_freq_chr ${Geno_1KG_dir}/freq_files/EUR/1KGPhase3.w_hm3.EUR.chr \
  --plink ${plink1_9} \
  --pheno_name ${gwas} \
  --output ${TEDS_output_dir}/PolygenicScores_non_nested/EUR/${gwas}/TEDS.w_hm3.${gwas}.EUR
n=$(($n+1))
done</code></pre>
</details>
<p><br/></p>
</div>
<div id="lassosum-1" class="section level4">
<h4><span class="header-section-number">3.4.2.4</span> lassosum</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Here we only calculate scores relevent to the phenotyps that we will use for comparing methods
n=0
for gwas in $(echo HEIG03 EDUC03 ADHD04 BODY11);do
qsub -pe smp 6 -l h_vmem=10G /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer_lassosum/Scaled_polygenic_scorer_lassosum.R \
  --target_plink_chr /users/k1806347/brc_scratch/Data/TEDS/Genotype/Harmonised/TEDS.w_hm3.QCd.AllSNP.chr \
    --target_keep /users/k1806347/brc_scratch/Data/TEDS/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
  --ref_model ${Geno_1KG_dir}/Score_files_for_poylygenic_lassosum/${gwas}/1KGPhase3.w_hm3.${gwas}.unvalidated.model.RDS \
  --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_lassosum/${gwas}/1KGPhase3.w_hm3.${gwas}.EUR.scale \
  --pheno_name ${gwas} \
  --n_cores 6 \
  --output /users/k1806347/brc_scratch/Data/TEDS/PolygenicScores_lassosum/EUR/${gwas}/TEDS.w_hm3.${gwas}.EUR
done
</code></pre>
</details>
<p><br/></p>
</div>
<div id="prscs-1" class="section level4">
<h4><span class="header-section-number">3.4.2.5</span> PRScs</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

n=0
for gwas in $(echo HEIG03 EDUC03 ADHD04 BODY11);do
qsub /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer_PRScs/Scaled_polygenic_scorer_PRScs.R \
  --target_plink_chr ${TEDS_output_dir}/Genotype/Harmonised/TEDS.w_hm3.QCd.AllSNP.chr \
    --target_keep ${TEDS_output_dir}/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
  --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic_PRScs/${gwas}/1KGPhase3.w_hm3.${gwas} \
  --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_PRScs/${gwas}/1KGPhase3.w_hm3.${gwas}.EUR.scale \
  --ref_freq_chr ${Geno_1KG_dir}/freq_files/EUR/1KGPhase3.w_hm3.EUR.chr \
  --plink ${plink1_9} \
  --pheno_name ${gwas} \
  --output ${TEDS_output_dir}/PolygenicScores_PRScs/EUR/${gwas}/TEDS.w_hm3.${gwas}.EUR
done</code></pre>
</details>
<p><br/></p>
</div>
<div id="sblup-1" class="section level4">
<h4><span class="header-section-number">3.4.2.6</span> SBLUP</h4>
<details>
<p><summary>See code</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

mkdir -p ${TEDS_output_dir}/PolygenicScores_SBLUP/EUR

# Create a list of gwas that haven&#39;t got corresponding PRS files in TEDS
&gt; ${TEDS_output_dir}/PolygenicScores_SBLUP/EUR/todo_SBLUP.txt
for gwas in $(echo HEIG03 EDUC03 ADHD04 BODY11);do
if [ ! -f ${TEDS_output_dir}/PolygenicScores_SBLUP/EUR/${gwas}/TEDS.w_hm3.${gwas}.EUR.SBLUP_profiles ]; then
echo $gwas &gt;&gt; ${TEDS_output_dir}/PolygenicScores_SBLUP/EUR/todo_SBLUP.txt
fi
done

n=0
for gwas in $(cat ${TEDS_output_dir}/PolygenicScores_SBLUP/EUR/todo_SBLUP.txt);do
qsub -N $(echo SBLUP_job$(($n+25))) -hold_jid $(echo SBLUP_job$(($n+0))) /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer_SBLUP/Scaled_polygenic_scorer_SBLUP.R \
  --target_plink_chr ${TEDS_output_dir}/Genotype/Harmonised/TEDS.w_hm3.QCd.AllSNP.chr \
    --target_keep ${TEDS_output_dir}/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
  --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic_SBLUP/${gwas}/GWAS_sumstats_SBLUP.sblup.cojo \
  --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_SBLUP/${gwas}/1KGPhase3.w_hm3.${gwas}.EUR.scale \
  --ref_freq_chr ${Geno_1KG_dir}/freq_files/EUR/1KGPhase3.w_hm3.EUR.chr \
  --plink ${plink1_9} \
  --pheno_name ${gwas} \
  --output ${TEDS_output_dir}/PolygenicScores_SBLUP/EUR/${gwas}/TEDS.w_hm3.${gwas}.EUR
n=$(($n+1))
done
</code></pre>
</details>
<p><br/></p>
</div>
</div>
</div>
<div id="estimating-predictive-ability" class="section level2">
<h2><span class="header-section-number">3.5</span> Estimating predictive ability</h2>
<p>All models were derived using elastic-net regularisation to reduce the likelihood of overfitting and account for multicollinearity when modelling highly correlated predictors. 10-fold cross validation was performed using 80% of individuals to identify optimal parameters, with subsequent test-set validation in the remaining 20% of individuals to estimate the predictive utility among individuals not included in the parameter selection process.</p>
<p>Model building and evaluation was performed using an Rscript called Model_builder.R (more information <a href="https://github.com/opain/GenoPred/tree/master/Scripts/Model_builder">here</a>).</p>
<div id="uk-biobank-1" class="section level3">
<h3><span class="header-section-number">3.5.1</span> UK Biobank</h3>
<details>
<p><summary>pT + clump PRSs: Sparse</summary></p>
<pre class="bash"><code>##############################
# Evaluating predictive utility of pT + clump PRSs across multiple pTs individually and in combination
##############################

# Make required directories
for pheno_i in $(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth);do
mkdir -p /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs
done

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

for i in $(seq 1 9);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs.predictor_groups &lt;&lt;EOF
predictors 
${UKBB_output}/PRS_for_comparison/1KG_ref/pt_clump/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}.profiles
EOF

done

# Derive and evaluate models
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03 0.013 0.00164 0.005)

for i in $(seq 1 9);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

  qsub -l h_vmem=5G -pe smp 2 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
    --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs \
    --n_core 2 \
    --compare_predictors T \
    --assoc T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>pT + clump PRSs: Dense</summary></p>
<pre class="bash"><code>##############################
# Evaluating predictive utility of pT + clump PRSs across multiple pTs individually and in combination
##############################

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

for i in $(seq 2 2);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs-dense.predictor_groups &lt;&lt;EOF
predictors 
${UKBB_output}/PRS_for_comparison/1KG_ref/pt_clump_dense/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}.profiles
EOF

done

# Derive and evaluate models
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03)

for i in $(seq 2 2);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

  qsub -l h_vmem=20G -pe smp 2 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
    --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs-dense \
    --n_core 2 \
    --model_comp F \
    --assoc T \
    --compare_predictors T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs-dense.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>pT + clump PRSs: Sparse (non-nested)</summary></p>
<pre class="bash"><code>##############################
# Evaluating predictive utility of pT + clump PRSs across multiple pTs individually and in combination
##############################

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

for i in $(seq 1 9);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_non_nested.predictor_groups &lt;&lt;EOF
predictors 
${UKBB_output}/PRS_for_comparison/1KG_ref/pt_clump_non_nested/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}.profiles
EOF

done

# Derive and evaluate models
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03 0.013 0.00164 0.005)

for i in $(seq 1 9);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

  qsub -l h_vmem=5G -pe smp 2 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
    --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_non_nested \
    --n_core 2 \
    --compare_predictors T \
    --assoc T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_non_nested.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>lassosum PRSs</summary></p>
<pre class="bash"><code>################################
# Evaluate use of lassosum PRSs when using multiple shrinkage parameters individually and in combination
################################

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

for i in $(seq 1 9);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_lassosum.predictor_groups &lt;&lt;EOF
predictors 
${UKBB_output}/PRS_for_comparison/1KG_ref/lassosum/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}.profiles
EOF

done

# Derive and evaluate
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03 0.013 0.00164 0.005)

for i in $(seq 1 9);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

qsub -l h_vmem=10G -pe smp 2 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
  --pheno ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
  --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
  --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_lassosum \
  --n_core 2 \
  --compare_predictors T \
  --assoc T \
  --outcome_pop_prev ${prev_i} \
  --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_lassosum.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>PRScs PRSs</summary></p>
<pre class="bash"><code>################################
# Evaluate use of multiple PRSs based on different shrinkage parameters, and use of pseudo-validated PRS (PRScs)
################################

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

for i in $(seq 1 9);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_PRScs.predictor_groups &lt;&lt;EOF
predictors 
${UKBB_output}/PRS_for_comparison/1KG_ref/PRScs/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}.profiles
EOF

done

# Derive and evaluate
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03 0.013 0.00164 0.005)

for i in $(seq 1 9);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

qsub -l h_vmem=5G -pe smp 2 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
  --pheno ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
  --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
  --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_PRScs \
  --n_core 2 \
  --compare_predictors T \
  --assoc T \
  --outcome_pop_prev ${prev_i} \
  --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_PRScs.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>SBLUP PRSs</summary></p>
<pre class="bash"><code>################################
# Evaluate use of SBLUP PRS
################################

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)

for i in $(seq 7 9);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_SBLUP.predictor_groups &lt;&lt;EOF
predictors 
${UKBB_output}/PRS_for_comparison/1KG_ref/SBLUP/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}.profiles
EOF

done

# Derive and evaluate
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth)
pheno_file=$(echo ever_depressed_pheno_final.UpdateIDs.txt UKBB_Fluid.intelligence.score.UpdateIDs.pheno UKBB_BMI.score.UpdateIDs.pheno UKBB_Height.score.UpdateIDs.pheno t2d_only_111119.UpdateIDs.txt cad_only_111119.UpdateIDs.txt UKBB.IBD.txt UKBB.MultiScler.txt UKBB.RheuArth.txt)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 SCLE02 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03 0.013 0.00164 0.005)

for i in $(seq 7 9);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

qsub -l h_vmem=10G -pe smp 2 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
  --pheno /users/k1806347/brc_scratch/Data/UKBB/Phenotype/${pheno_i}/${pheno_file_i} \
  --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
  --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_SBLUP \
  --n_core 2 \
  --compare_predictors T \
  --assoc T \
  --outcome_pop_prev ${prev_i} \
  --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs_SBLUP.predictor_groups
done
</code></pre>
</details>
<p><br/></p>
</div>
<div id="teds-1" class="section level3">
<h3><span class="header-section-number">3.5.2</span> TEDS</h3>
<details>
<p><summary>pT + clump PRSs: Sparse</summary></p>
<pre class="bash"><code>##############################
# Evaluating predictive utility of pT + clump PRSs across multiple pTs individually and in combination
##############################

# Make required directories
for pheno_i in $(echo Height21 BMI21 GCSE ADHD);do
mkdir -p /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs
done

# Create a file listing the predictors files
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)

for i in $(seq 1 4);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs.predictor_groups &lt;&lt;EOF
predictors 
/users/k1806347/brc_scratch/Data/TEDS/PolygenicScores/EUR/${gwas_i}/TEDS.w_hm3.${gwas_i}.EUR.profiles
EOF

done

# Derive and evaluate models
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)
prev=$(echo NA NA NA NA)

for i in $(seq 1 4);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

  qsub -l h_vmem=5G -pe smp 4 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno /users/k1806347/brc_scratch/Data/TEDS/Phenotypic/Derived_outcomes/TEDS_${pheno_i}.txt \
      --keep /users/k1806347/brc_scratch/Data/TEDS/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
    --out /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs \
    --n_core 4 \
    --compare_predictors T \
    --assoc T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>pT + clump PRSs: Dense</summary></p>
<pre class="bash"><code>##############################
# Evaluating predictive utility of pT + clump PRSs across multiple pTs individually and in combination
##############################

# Create a file listing the predictors files
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)

for i in $(seq 4 4);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs-dense.predictor_groups &lt;&lt;EOF
predictors 
/users/k1806347/brc_scratch/Data/TEDS/PolygenicScores_dense/EUR/${gwas_i}/TEDS.w_hm3.${gwas_i}.EUR.profiles
EOF

done

# Derive and evaluate models
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)
prev=$(echo NA NA NA NA)

for i in $(seq 1 4);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

  qsub -l h_vmem=5G -pe smp 4 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno /users/k1806347/brc_scratch/Data/TEDS/Phenotypic/Derived_outcomes/TEDS_${pheno_i}.txt \
      --keep /users/k1806347/brc_scratch/Data/TEDS/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
    --out /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs-dense \
    --n_core 4 \
    --assoc T \
    --compare_predictors T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs-dense.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>pT + clump PRSs: Sparse (non-nested)</summary></p>
<pre class="bash"><code>##############################
# Evaluating predictive utility of pT + clump PRSs across multiple pTs individually and in combination
##############################

# Make required directories
for pheno_i in $(echo Height21 BMI21 GCSE ADHD);do
mkdir -p /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs
done

# Create a file listing the predictors files
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)

for i in $(seq 1 4);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_non_nested.predictor_groups &lt;&lt;EOF
predictors 
/users/k1806347/brc_scratch/Data/TEDS/PolygenicScores_non_nested/EUR/${gwas_i}/TEDS.w_hm3.${gwas_i}.EUR.profiles
EOF

done

# Derive and evaluate models
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)
prev=$(echo NA NA NA NA)

for i in $(seq 1 4);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

  qsub -l h_vmem=5G -pe smp 4 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno /users/k1806347/brc_scratch/Data/TEDS/Phenotypic/Derived_outcomes/TEDS_${pheno_i}.txt \
      --keep /users/k1806347/brc_scratch/Data/TEDS/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
    --out /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_non_nested \
    --n_core 4 \
    --compare_predictors T \
    --assoc T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_non_nested.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>lassosum PRSs</summary></p>
<pre class="bash"><code>################################
# Evaluate use of lassosum PRSs when using multiple shrinkage parameters individually and in combination
################################

# Create a file listing the predictors files
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)

for i in $(seq 1 4);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_lassosum.predictor_groups &lt;&lt;EOF
predictors 
/users/k1806347/brc_scratch/Data/TEDS/PolygenicScores_lassosum/EUR/${gwas_i}/TEDS.w_hm3.${gwas_i}.EUR.lassosum_profiles
EOF

done

# Derive and evaluate
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)
prev=$(echo NA NA NA NA)


for i in $(seq 1 4);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

qsub -l h_vmem=10G -pe smp 4 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
--pheno /users/k1806347/brc_scratch/Data/TEDS/Phenotypic/Derived_outcomes/TEDS_${pheno_i}.txt \
--keep /users/k1806347/brc_scratch/Data/TEDS/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
--out /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_lassosum \
--n_core 4 \
--compare_predictors T \
--assoc T \
--outcome_pop_prev ${prev_i} \
--predictors /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_lassosum.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>PRScs PRSs</summary></p>
<pre class="bash"><code>################################
# Evaluate use of multiple PRSs based on different shrinkage parameters, and use of pseudo-validated PRS (PRScs)
################################

# Create a file listing the predictors files
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)

for i in $(seq 1 4);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_PRScs.predictor_groups &lt;&lt;EOF
predictors 
/users/k1806347/brc_scratch/Data/TEDS/PolygenicScores_PRScs/EUR/${gwas_i}/TEDS.w_hm3.${gwas_i}.EUR.PRScs_profiles
EOF

done

# Derive and evaluate
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)
prev=$(echo NA NA NA NA)

for i in $(seq 1 4);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

qsub -l h_vmem=10G -pe smp 4 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
--pheno /users/k1806347/brc_scratch/Data/TEDS/Phenotypic/Derived_outcomes/TEDS_${pheno_i}.txt \
--keep /users/k1806347/brc_scratch/Data/TEDS/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
--out /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_PRScs \
--n_core 4 \
--compare_predictors T \
--assoc T \
--outcome_pop_prev ${prev_i} \
--predictors /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_PRScs.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>SBLUP PRSs</summary></p>
<pre class="bash"><code>################################
# Evaluate use of multiple PRSs based on different shrinkage parameters, and use of pseudo-validated PRS (PRScs)
################################

# Create a file listing the predictors files
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)

for i in $(seq 1 4);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_SBLUP.predictor_groups &lt;&lt;EOF
predictors 
/users/k1806347/brc_scratch/Data/TEDS/PolygenicScores_SBLUP/EUR/${gwas_i}/TEDS.w_hm3.${gwas_i}.EUR.SBLUP_profiles
EOF

done

# Derive and evaluate
pheno=$(echo Height21 BMI21 GCSE ADHD)
gwas=$(echo HEIG03 BODY11 EDUC03 ADHD04)
prev=$(echo NA NA NA NA)

for i in $(seq 1 4);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

qsub -l h_vmem=5G -pe smp 4 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
--pheno /users/k1806347/brc_scratch/Data/TEDS/Phenotypic/Derived_outcomes/TEDS_${pheno_i}.txt \
--keep /users/k1806347/brc_scratch/Data/TEDS/Projected_PCs/Ancestry_idenitfier/TEDS.w_hm3.AllAncestry.EUR.keep \
--out /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_SBLUP \
--n_core 4 \
--compare_predictors T \
--assoc T \
--outcome_pop_prev ${prev_i} \
--predictors /users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/${pheno_i}/Association_withPRSs/TEDS.w_hm3.${gwas_i}.EUR-PRSs_SBLUP.predictor_groups
done
</code></pre>
</details>
<p><br/></p>
<hr />
</div>
</div>
</div>
<div id="results" class="section level1">
<h1><span class="header-section-number">4</span> Results</h1>
<p>The pattern of results are consistent between 10-fold cross-validation and test set validation.</p>
<p>Modelling multiple PRSs based on a range of parameters consistenly provides a small improvement over the best single PRS idenitfied by cross-validation.</p>
<p>As previous studies have shown, performing a grid search of shrinkage parameters with both lassosum- and PRScs-based PRSs consistently out performs PRS derived using the traditional pT + clump method.</p>
<p>The pseudovalidation approach within lassosum performs worse than any other approach tested here. In contrast the PRScs pseduovalidated PRS performs well, providing nearly the best prediction for all outcomes.</p>
<p><br/></p>
<div id="uk-biobank-2" class="section level2">
<h2><span class="header-section-number">4.1</span> UK Biobank</h2>
<details>
<p><summary>Code for plotting results</summary></p>
<pre class="bash"><code>#####
# Compare results from each approach
#####
module add general/R/3.5.0
R

pheno&lt;-c(&#39;Depression&#39;,&#39;Intelligence&#39;,&#39;BMI&#39;,&#39;Height&#39;,&#39;T2D&#39;,&#39;CAD&#39;)
gwas&lt;-c(&#39;DEPR06&#39;,&#39;COLL01&#39;,&#39;BODY03&#39;,&#39;HEIG03&#39;,&#39;DIAB05&#39;,&#39;COAD01&#39;)

# Read in the results, labelling which parameters where pseudovalidated and validated using 10-fold cross validation
All_res&lt;-NULL
for(i in c(1:6)){
  pT_clump&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/UKBB.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  pT_clump$Method&lt;-&quot;pT + clump\n(sparse)&quot;
  Param_tmp&lt;-sort(as.numeric(gsub(&#39;e.&#39;,&#39;e-&#39;,gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,pT_clump$Model)))))
  pT_clump$Param&lt;-as.character(as.numeric(gsub(&#39;e.&#39;,&#39;e-&#39;,gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,pT_clump$Model)))))
  pT_clump$Param[dim(pT_clump)[1]]&lt;-&#39;Multi-PRS&#39;
  pT_clump&lt;-pT_clump[match(c(Param_tmp,&#39;Multi-PRS&#39;), pT_clump$Param),]
  pT_clump$Model&lt;-NULL
  pT_clump$Group&lt;-NA
  pT_clump$Group[pT_clump$CrossVal_R == max(abs(pT_clump$CrossVal_R[pT_clump$Param != &#39;Multi-PRS&#39;]))]&lt;-&#39;10FCVal&#39;
  pT_clump$Group[pT_clump$Param == &#39;Multi-PRS&#39;]&lt;-&#39;Multi-PRS&#39;
  pT_clump&lt;-pT_clump[!is.na(pT_clump$Group),]

  pT_clump_dense&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/UKBB.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs-dense.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  pT_clump_dense$Method&lt;-&quot;pT + clump\n(dense)&quot;
  Param_tmp&lt;-sort(as.numeric(gsub(&#39;e.&#39;,&#39;e-&#39;,gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;_&#39;),&#39;&#39;,pT_clump_dense$Model)))))
  pT_clump_dense$Param&lt;-as.character(as.numeric(gsub(&#39;e.&#39;,&#39;e-&#39;,gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;_&#39;),&#39;&#39;,pT_clump_dense$Model)))))
  pT_clump_dense$Param[dim(pT_clump_dense)[1]]&lt;-&#39;Multi-PRS&#39;
  pT_clump_dense&lt;-pT_clump_dense[match(c(Param_tmp,&#39;Multi-PRS&#39;), pT_clump_dense$Param),]
  pT_clump_dense$Model&lt;-NULL
  pT_clump_dense$Group&lt;-NA
  pT_clump_dense$Group[pT_clump_dense$CrossVal_R == max(abs(pT_clump_dense$CrossVal_R[pT_clump_dense$Param != &#39;Multi-PRS&#39;]))][1]&lt;-&#39;10FCVal&#39;
  pT_clump_dense$Group[pT_clump_dense$Param == &#39;Multi-PRS&#39;]&lt;-&#39;Multi-PRS&#39;
  pT_clump_dense&lt;-pT_clump_dense[!is.na(pT_clump_dense$Group),]
  
  lassosum_res&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/UKBB.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs_lassosum.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  lassosum_res$Method&lt;-&#39;lassosum&#39;
  lassosum_res$Param&lt;-gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,lassosum_res$Model))
  lassosum_res$Param[dim(lassosum_res)[1]]&lt;-&#39;Multi-PRS&#39;
  lassosum_res$Model&lt;-NULL
  lassosum_val&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Data/1KG/Phase3/Score_files_for_poylygenic_lassosum/&#39;,gwas[i],&#39;/1KGPhase3.w_hm3.&#39;,gwas[i],&#39;.log&#39;), sep=&#39;&amp;&#39;)
  lassosum_val_s&lt;-as.numeric(gsub(&#39;s = &#39;,&#39;&#39;,lassosum_val$V1[grepl(&#39;s = &#39;,lassosum_val$V1)]))
  lassosum_val_lambda&lt;-as.numeric(gsub(&#39;lambda =&#39;,&#39;&#39;,lassosum_val$V1[grepl(&#39;lambda =&#39;,lassosum_val$V1)]))
  lassosum_val_param&lt;-paste0(&#39;s&#39;,lassosum_val_s,&#39;.lambda&#39;,lassosum_val_lambda)
  lassosum_val_param&lt;-substr(lassosum_val_param, 1, nchar(lassosum_val_param)-1) 
  lassosum_res$Group&lt;-NA
  lassosum_res$Group[which(lassosum_res$CrossVal_R == max(abs(lassosum_res$CrossVal_R[lassosum_res$Param != &#39;Multi-PRS&#39;])))[1]]&lt;-&#39;10FCVal&#39;
  lassosum_res$Group[grepl(lassosum_val_param,lassosum_res$Param)]&lt;-&#39;PseudoVal&#39;
  lassosum_res$Group[lassosum_res$Param == &#39;Multi-PRS&#39;]&lt;-&#39;Multi-PRS&#39;
  lassosum_res&lt;-lassosum_res[!is.na(lassosum_res$Group),]
  
  PRScs_res&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/UKBB.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs_PRScs.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  PRScs_res$Method&lt;-&#39;PRScs&#39;
  PRScs_res$Param&lt;-gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,PRScs_res$Model))
  PRScs_res$Param[dim(PRScs_res)[1]]&lt;-&#39;Multi-PRS&#39;
  PRScs_res$Model&lt;-NULL
  PRScs_res$Group&lt;-NA
  PRScs_res$Group[which(PRScs_res$CrossVal_R == max(abs(PRScs_res$CrossVal_R[PRScs_res$Param != &#39;Multi-PRS&#39; &amp; PRScs_res$Param != &#39;phiauto&#39;])))[1]]&lt;-&#39;10FCVal&#39;
  PRScs_res$Group[PRScs_res$Param == &#39;phiauto&#39;]&lt;-&#39;PseudoVal&#39;
  PRScs_res$Group[PRScs_res$Param == &#39;Multi-PRS&#39;]&lt;-&#39;Multi-PRS&#39;
  PRScs_res&lt;-PRScs_res[!is.na(PRScs_res$Group),]

  SBLUP_res&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/UKBB.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs_SBLUP.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  SBLUP_res$Method&lt;-&#39;SBLUP&#39;
  SBLUP_res$Param&lt;-gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,SBLUP_res$Model))
  SBLUP_res$Model&lt;-NULL
  SBLUP_res$Group&lt;-NA
  SBLUP_res$Group[1]&lt;-&#39;PseudoVal&#39;
  SBLUP_res&lt;-SBLUP_res[!is.na(SBLUP_res$Group),]

#  res&lt;-do.call(rbind, list(pT_clump, pT_clump_dense, lassosum_res, PRScs_res))
  res&lt;-do.call(rbind, list(pT_clump, lassosum_res, PRScs_res, SBLUP_res))
  res$Phenotype&lt;-pheno[i]
  res$Cross_LiabR2&lt;-NULL
  res$Indep_LiabR2&lt;-NULL
  res$CrossVal_pval&lt;-NULL
  res$IndepVal_pval&lt;-NULL

  All_res&lt;-rbind(All_res, res)
}

# Reformat to be a table
All_res&lt;-All_res[c(&#39;Phenotype&#39;,&#39;Method&#39;,&#39;Group&#39;,&#39;CrossVal_R&#39;,&#39;CrossVal_R_SE&#39;,&#39;IndepVal_R&#39;,&#39;IndepVal_R_SE&#39;)]

write.csv(All_res, &#39;/mnt/lustre/users/k1806347/Analyses/UKBB_outcomes_for_prediction/PRS_method_comp_UKBB.csv&#39;, row.names=F)

###
# Plot comparison between validated PRS vs multi-PRS when using pT + clump method
###

library(ggplot2)
library(cowplot)

All_res$Method&lt;-factor(All_res$Method, levels=unique(All_res$Method))

plots&lt;-list()
for(i in 1:6){
plots[[pheno[i]]] &lt;- ggplot( All_res[All_res$Phenotype==pheno[i],], aes(x=Method, y=CrossVal_R, fill=Group)) +
                      geom_bar(stat=&quot;identity&quot;, position=position_dodge(preserve = &quot;single&quot;), width = 0.7, colour=&#39;black&#39;) +
                      geom_errorbar(aes(ymin=CrossVal_R-CrossVal_R_SE, ymax=CrossVal_R+CrossVal_R_SE), width=.2, position=position_dodge(width = 0.7, preserve = &quot;single&quot;)) +
                      labs(y=&quot;Correlation (SE)&quot;, x=&#39;&#39;, title=pheno[i]) +
                      coord_cartesian(ylim=c(min(All_res$CrossVal_R[All_res$Phenotype==pheno[i]])-0.02, max(All_res$CrossVal_R[All_res$Phenotype==pheno[i]])+0.025), clip=&quot;on&quot;) +
                              theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

png(&#39;/mnt/lustre/users/k1806347/Analyses/UKBB_outcomes_for_prediction/PRS_method_comp_CrossVal_UKBB.png&#39;, units=&#39;px&#39;, res=300, width=3000, height=3750)
plot_grid(plotlist=plots, ncol = 2)
dev.off()

plots&lt;-list()
for(i in 1:6){
plots[[pheno[i]]] &lt;- ggplot( All_res[All_res$Phenotype==pheno[i],], aes(x=Method, y=IndepVal_R, fill=Group)) +
                      geom_bar(stat=&quot;identity&quot;, position=position_dodge(preserve = &quot;single&quot;), width = 0.7, colour=&#39;black&#39;) +
                      geom_errorbar(aes(ymin=IndepVal_R-IndepVal_R_SE, ymax=IndepVal_R+IndepVal_R_SE), width=.2, position=position_dodge(width = 0.7, preserve = &quot;single&quot;)) +
                      labs(y=&quot;Correlation (SE)&quot;, x=&#39;&#39;, title=pheno[i]) +
                      coord_cartesian(ylim=c(min(All_res$IndepVal_R[All_res$Phenotype==pheno[i]])-0.02, max(All_res$IndepVal_R[All_res$Phenotype==pheno[i]])+0.025), clip=&quot;on&quot;) +
                              theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

png(&#39;/mnt/lustre/users/k1806347/Analyses/UKBB_outcomes_for_prediction/PRS_method_comp_IndepVal_UKBB.png&#39;, units=&#39;px&#39;, res=300, width=3000, height=3750)
plot_grid(plotlist=plots, ncol = 2)
dev.off()

q()
n</code></pre>
</details>
<details>
<p><summary>Show UKBB cross-validation results</summary></p>
<center>
<div class="figure">
<img src="Images/Determine_optimal_polygenic_scoring_approach/PRS_method_comp_CrossVal_UKBB.png" alt="Figure 1: Predictive utility estimated using 10-fold cross-validation" />
<p class="caption">Figure 1: Predictive utility estimated using 10-fold cross-validation</p>
</div>
</details>
<details>
<p><summary>Show UKBB test-validation results</summary></p>
<div class="figure">
<img src="Images/Determine_optimal_polygenic_scoring_approach/PRS_method_comp_IndepVal_UKBB.png" alt="Figure 2: Predictive utility estimated using test set validation" />
<p class="caption">Figure 2: Predictive utility estimated using test set validation</p>
</div>

</details>
<details>
<p><summary>Show UKBB results table</summary></p>
<table>
<caption>Table 1: Correlation between PRS model predictions and observed values in UK Biobank</caption>
<thead>
<tr class="header">
<th align="left">Phenotype</th>
<th align="left">Method</th>
<th align="left">Group</th>
<th align="left">CrossVal R (SE)</th>
<th align="left">IndepVal R (SE)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Depression</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">(sparse) 10FC</td>
<td align="left">Val 0.119 (0.004)</td>
<td align="left">0.108 (0</td>
<td align="left">.007)</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Depression</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">(sparse) Mult</td>
<td align="left">i-PRS 0.126 (0.004)</td>
<td align="left">0.12 (0.</td>
<td align="left">007)</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Depression</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.077 (0.004)</td>
<td align="left">0.081 (0.007)</td>
</tr>
<tr class="even">
<td align="left">Depression</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.139 (0.004)</td>
<td align="left">0.125 (0.007)</td>
</tr>
<tr class="odd">
<td align="left">Depression</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.141 (0.004)</td>
<td align="left">0.128 (0.007)</td>
</tr>
<tr class="even">
<td align="left">Depression</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.137 (0.004)</td>
<td align="left">0.122 (0.007)</td>
</tr>
<tr class="odd">
<td align="left">Depression</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.138 (0.004)</td>
<td align="left">0.124 (0.007)</td>
</tr>
<tr class="even">
<td align="left">Depression</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.14 (0.004)</td>
<td align="left">0.125 (0.007)</td>
</tr>
<tr class="odd">
<td align="left">Depression</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.138 (0.004)</td>
<td align="left">0.122 (0.007)</td>
</tr>
<tr class="even">
<td align="left">Intelligence</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">(sparse) 10FC</td>
<td align="left">Val 0.09 (0.004)</td>
<td align="left">0.085 (0</td>
<td align="left">.007)</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Intelligence</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">(sparse) Mult</td>
<td align="left">i-PRS 0.094 (0.004)</td>
<td align="left">0.094 (0</td>
<td align="left">.007)</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Intelligence</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.065 (0.004)</td>
<td align="left">0.067 (0.007)</td>
</tr>
<tr class="odd">
<td align="left">Intelligence</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.103 (0.004)</td>
<td align="left">0.097 (0.007)</td>
</tr>
<tr class="even">
<td align="left">Intelligence</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.106 (0.004)</td>
<td align="left">0.102 (0.007)</td>
</tr>
<tr class="odd">
<td align="left">Intelligence</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.102 (0.004)</td>
<td align="left">0.096 (0.007)</td>
</tr>
<tr class="even">
<td align="left">Intelligence</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.1 (0.004)</td>
<td align="left">0.099 (0.007)</td>
</tr>
<tr class="odd">
<td align="left">Intelligence</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.104 (0.004)</td>
<td align="left">0.1 (0.007)</td>
</tr>
<tr class="even">
<td align="left">Intelligence</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.103 (0.004)</td>
<td align="left">0.099 (0.007)</td>
</tr>
<tr class="odd">
<td align="left">BMI</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">(sparse) 10FC</td>
<td align="left">Val 0.255 (0.002)</td>
<td align="left">0.261 (0</td>
<td align="left">.004)</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">BMI</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">(sparse) Mult</td>
<td align="left">i-PRS 0.271 (0.002)</td>
<td align="left">0.276 (0</td>
<td align="left">.004)</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">BMI</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.215 (0.002)</td>
<td align="left">0.216 (0.004)</td>
</tr>
<tr class="even">
<td align="left">BMI</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.289 (0.002)</td>
<td align="left">0.295 (0.003)</td>
</tr>
<tr class="odd">
<td align="left">BMI</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.294 (0.002)</td>
<td align="left">0.299 (0.003)</td>
</tr>
<tr class="even">
<td align="left">BMI</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.281 (0.002)</td>
<td align="left">0.287 (0.004)</td>
</tr>
<tr class="odd">
<td align="left">BMI</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.272 (0.002)</td>
<td align="left">0.275 (0.004)</td>
</tr>
<tr class="even">
<td align="left">BMI</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.29 (0.002)</td>
<td align="left">0.295 (0.003)</td>
</tr>
<tr class="odd">
<td align="left">BMI</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.277 (0.002)</td>
<td align="left">0.281 (0.004)</td>
</tr>
<tr class="even">
<td align="left">Height</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">(sparse) 10FC</td>
<td align="left">Val 0.299 (0.002)</td>
<td align="left">0.303 (0</td>
<td align="left">.003)</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Height</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">(sparse) Mult</td>
<td align="left">i-PRS 0.315 (0.002)</td>
<td align="left">0.318 (0</td>
<td align="left">.003)</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Height</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.342 (0.002)</td>
<td align="left">0.347 (0.003)</td>
</tr>
<tr class="odd">
<td align="left">Height</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.285 (0.002)</td>
<td align="left">0.29 (0.003)</td>
</tr>
<tr class="even">
<td align="left">Height</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.347 (0.002)</td>
<td align="left">0.351 (0.003)</td>
</tr>
<tr class="odd">
<td align="left">Height</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.342 (0.002)</td>
<td align="left">0.346 (0.003)</td>
</tr>
<tr class="even">
<td align="left">Height</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.342 (0.002)</td>
<td align="left">0.345 (0.003)</td>
</tr>
<tr class="odd">
<td align="left">Height</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.344 (0.002)</td>
<td align="left">0.347 (0.003)</td>
</tr>
<tr class="even">
<td align="left">Height</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.295 (0.002)</td>
<td align="left">0.298 (0.003)</td>
</tr>
<tr class="odd">
<td align="left">T2D</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">(sparse) 10FC</td>
<td align="left">Val 0.08 (0.002)</td>
<td align="left">0.083 (0</td>
<td align="left">.004)</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">T2D</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">(sparse) Mult</td>
<td align="left">i-PRS 0.103 (0.002)</td>
<td align="left">0.106 (0</td>
<td align="left">.004)</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">T2D</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.099 (0.002)</td>
<td align="left">0.101 (0.004)</td>
</tr>
<tr class="even">
<td align="left">T2D</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.103 (0.002)</td>
<td align="left">0.103 (0.004)</td>
</tr>
<tr class="odd">
<td align="left">T2D</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.114 (0.002)</td>
<td align="left">0.114 (0.004)</td>
</tr>
<tr class="even">
<td align="left">T2D</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.108 (0.002)</td>
<td align="left">0.106 (0.004)</td>
</tr>
<tr class="odd">
<td align="left">T2D</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.109 (0.002)</td>
<td align="left">0.109 (0.004)</td>
</tr>
<tr class="even">
<td align="left">T2D</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.114 (0.002)</td>
<td align="left">0.113 (0.004)</td>
</tr>
<tr class="odd">
<td align="left">T2D</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.088 (0.002)</td>
<td align="left">0.087 (0.004)</td>
</tr>
<tr class="even">
<td align="left">CAD</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">(sparse) 10FC</td>
<td align="left">Val 0.08 (0.002)</td>
<td align="left">0.069 (0</td>
<td align="left">.004)</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">CAD</td>
<td align="left">pT + clump</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">(sparse) Mult</td>
<td align="left">i-PRS 0.099 (0.002)</td>
<td align="left">0.09 (0.</td>
<td align="left">004)</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">CAD</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.095 (0.002)</td>
<td align="left">0.09 (0.004)</td>
</tr>
<tr class="odd">
<td align="left">CAD</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.099 (0.002)</td>
<td align="left">0.092 (0.004)</td>
</tr>
<tr class="even">
<td align="left">CAD</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.107 (0.002)</td>
<td align="left">0.099 (0.004)</td>
</tr>
<tr class="odd">
<td align="left">CAD</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.103 (0.002)</td>
<td align="left">0.096 (0.004)</td>
</tr>
<tr class="even">
<td align="left">CAD</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.104 (0.002)</td>
<td align="left">0.096 (0.004)</td>
</tr>
<tr class="odd">
<td align="left">CAD</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.106 (0.002)</td>
<td align="left">0.099 (0.004)</td>
</tr>
<tr class="even">
<td align="left">CAD</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.087 (0.002)</td>
<td align="left">0.079 (0.004)</td>
</tr>
</tbody>
</table>
</details>
<p><br/></p>
</div>
<div id="teds-2" class="section level2">
<h2><span class="header-section-number">4.2</span> TEDS</h2>
<details>
<p><summary>Code for plotting results</summary></p>
<pre class="bash"><code>#####
# Compare results from each approach
#####
module add general/R/3.5.0
R

pheno&lt;-c(&#39;Height21&#39;, &#39;BMI21&#39;, &#39;GCSE&#39;, &#39;ADHD&#39;)
gwas&lt;-c(&#39;HEIG03&#39;, &#39;BODY11&#39;, &#39;EDUC03&#39;, &#39;ADHD04&#39;)

# Read in the results, labelling which parameters where pseudovalidated and validated using 10-fold cross validation
All_res&lt;-NULL
for(i in c(1:4)){
  pT_clump&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/TEDS.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  pT_clump$Method&lt;-&quot;pT&quot;
  Param_tmp&lt;-sort(as.numeric(gsub(&#39;e.&#39;,&#39;e-&#39;,gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,pT_clump$Model)))))
  pT_clump$Param&lt;-as.character(as.numeric(gsub(&#39;e.&#39;,&#39;e-&#39;,gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,pT_clump$Model)))))
  pT_clump$Param[dim(pT_clump)[1]]&lt;-&#39;Multi-PRS&#39;
  pT_clump&lt;-pT_clump[match(c(Param_tmp,&#39;Multi-PRS&#39;), pT_clump$Param),]
  pT_clump$Model&lt;-NULL
  pT_clump$Group&lt;-NA
  pT_clump$Group[pT_clump$CrossVal_R == max(abs(pT_clump$CrossVal_R[pT_clump$Param != &#39;Multi-PRS&#39;]))]&lt;-&#39;10FCVal&#39;
  pT_clump$Group[pT_clump$Param == &#39;Multi-PRS&#39;]&lt;-&#39;Multi-PRS&#39;
  pT_clump&lt;-pT_clump[!is.na(pT_clump$Group),]

  pT_clump_nn&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/TEDS.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs_non_nested.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  pT_clump_nn$Method&lt;-&quot;pT (non-nested)&quot;
  pT_clump_nn$Param&lt;-as.character(as.numeric(gsub(&#39;e.&#39;,&#39;e-&#39;,gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,pT_clump_nn$Model)))))
  for(j in (length(pT_clump_nn$Param)-1):1){
    if(j==1){
      pT_clump_nn$Param[j]&lt;-paste0(&#39;0 - &#39;,pT_clump_nn$Param[j])
    } else {
      pT_clump_nn$Param[j]&lt;-paste0(pT_clump_nn$Param[j-1],&#39; - &#39;,pT_clump_nn$Param[j])
    }
  }
  pT_clump_nn$Param[dim(pT_clump_nn)[1]]&lt;-&#39;Multi-PRS&#39;
  pT_clump_nn$Model&lt;-NULL
  pT_clump_nn$Group&lt;-NA
  pT_clump_nn$Group[pT_clump_nn$CrossVal_R == max(abs(pT_clump_nn$CrossVal_R[pT_clump_nn$Param != &#39;Multi-PRS&#39;]))]&lt;-&#39;10FCVal&#39;
  pT_clump_nn$Group[pT_clump_nn$Param == &#39;Multi-PRS&#39;]&lt;-&#39;Multi-PRS&#39;
  pT_clump_nn&lt;-pT_clump_nn[!is.na(pT_clump_nn$Group),]

  pT_clump_dense&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/TEDS.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs-dense.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  pT_clump_dense$Method&lt;-&quot;pT (dense)&quot;
  Param_tmp&lt;-sort(as.numeric(gsub(&#39;e.&#39;,&#39;e-&#39;,gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,pT_clump_dense$Model)))))
  pT_clump_dense$Param&lt;-as.character(as.numeric(gsub(&#39;e.&#39;,&#39;e-&#39;,gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,pT_clump_dense$Model)))))
  pT_clump_dense$Param[dim(pT_clump_dense)[1]]&lt;-&#39;Multi-PRS&#39;
  pT_clump_dense&lt;-pT_clump_dense[match(c(Param_tmp,&#39;Multi-PRS&#39;), pT_clump_dense$Param),]
  pT_clump_dense$Model&lt;-NULL
  pT_clump_dense$Group&lt;-NA
  pT_clump_dense$Group[pT_clump_dense$CrossVal_R == max(abs(pT_clump_dense$CrossVal_R[pT_clump_dense$Param != &#39;Multi-PRS&#39;]))][1]&lt;-&#39;10FCVal&#39;
  pT_clump_dense$Group[pT_clump_dense$Param == &#39;Multi-PRS&#39;]&lt;-&#39;Multi-PRS&#39;
  pT_clump_dense&lt;-pT_clump_dense[!is.na(pT_clump_dense$Group),]
  
  lassosum_res&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/TEDS.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs_lassosum.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  lassosum_res$Method&lt;-&#39;lassosum&#39;
  lassosum_res$Param&lt;-gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,lassosum_res$Model))
  lassosum_res$Param[dim(lassosum_res)[1]]&lt;-&#39;Multi-PRS&#39;
  lassosum_res$Model&lt;-NULL
  lassosum_val&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Data/1KG/Phase3/Score_files_for_poylygenic_lassosum/&#39;,gwas[i],&#39;/1KGPhase3.w_hm3.&#39;,gwas[i],&#39;.log&#39;), sep=&#39;&amp;&#39;)
  lassosum_val_s&lt;-as.numeric(gsub(&#39;s = &#39;,&#39;&#39;,lassosum_val$V1[grepl(&#39;s = &#39;,lassosum_val$V1)]))
  lassosum_val_lambda&lt;-as.numeric(gsub(&#39;lambda =&#39;,&#39;&#39;,lassosum_val$V1[grepl(&#39;lambda =&#39;,lassosum_val$V1)]))
  lassosum_val_param&lt;-paste0(&#39;s&#39;,lassosum_val_s,&#39;.lambda&#39;,lassosum_val_lambda)
  lassosum_val_param&lt;-substr(lassosum_val_param, 1, nchar(lassosum_val_param)-1) 
  lassosum_res$Group&lt;-NA
  lassosum_res$Group[which(lassosum_res$CrossVal_R == max(abs(lassosum_res$CrossVal_R[lassosum_res$Param != &#39;Multi-PRS&#39;])))[1]]&lt;-&#39;10FCVal&#39;
  lassosum_res$Group[grepl(lassosum_val_param,lassosum_res$Param)]&lt;-&#39;PseudoVal&#39;
  lassosum_res$Group[lassosum_res$Param == &#39;Multi-PRS&#39;]&lt;-&#39;Multi-PRS&#39;
  lassosum_res&lt;-lassosum_res[!is.na(lassosum_res$Group),]
  
  PRScs_res&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/TEDS.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs_PRScs.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  PRScs_res$Method&lt;-&#39;PRScs&#39;
  PRScs_res$Param&lt;-gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,PRScs_res$Model))
  PRScs_res$Param[dim(PRScs_res)[1]]&lt;-&#39;Multi-PRS&#39;
  PRScs_res$Model&lt;-NULL
  PRScs_res$Group&lt;-NA
  PRScs_res$Group[which(PRScs_res$CrossVal_R == max(abs(PRScs_res$CrossVal_R[PRScs_res$Param != &#39;Multi-PRS&#39; &amp; PRScs_res$Param != &#39;phiauto&#39;])))[1]]&lt;-&#39;10FCVal&#39;
  PRScs_res$Group[PRScs_res$Param == &#39;phiauto&#39;]&lt;-&#39;PseudoVal&#39;
  PRScs_res$Group[PRScs_res$Param == &#39;Multi-PRS&#39;]&lt;-&#39;Multi-PRS&#39;
  PRScs_res&lt;-PRScs_res[!is.na(PRScs_res$Group),]

  SBLUP_res&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/TEDS_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRSs/TEDS.w_hm3.&#39;,gwas[i],&#39;.EUR-PRSs_SBLUP.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  SBLUP_res$Method&lt;-&#39;SBLUP&#39;
  SBLUP_res$Param&lt;-gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,SBLUP_res$Model))
  SBLUP_res$Model&lt;-NULL
  SBLUP_res$Group&lt;-NA
  SBLUP_res$Group[1]&lt;-&#39;PseudoVal&#39;
  SBLUP_res&lt;-SBLUP_res[!is.na(SBLUP_res$Group),]

  res&lt;-do.call(rbind, list(pT_clump, pT_clump_nn, pT_clump_dense, lassosum_res, PRScs_res, SBLUP_res))
  res$Phenotype&lt;-pheno[i]
  res$Cross_LiabR2&lt;-NULL
  res$Indep_LiabR2&lt;-NULL
  res$CrossVal_pval&lt;-NULL
  res$IndepVal_pval&lt;-NULL

  All_res&lt;-rbind(All_res, res)
}

# Reformat to be a table
All_res&lt;-All_res[c(&#39;Phenotype&#39;,&#39;Method&#39;,&#39;Group&#39;,&#39;CrossVal_R&#39;,&#39;CrossVal_R_SE&#39;,&#39;IndepVal_R&#39;,&#39;IndepVal_R_SE&#39;)]
All_res_tab&lt;-All_res
All_res_tab$Method&lt;-gsub(&#39;\n&#39;, &#39; &#39;, All_res_tab$Method)

write.csv(All_res_tab, &#39;/mnt/lustre/users/k1806347/Analyses/TEDS_outcomes_for_prediction/PRS_method_comp_TEDS.csv&#39;, row.names=F)

###
# Plot comparison between validated PRS vs multi-PRS when using pT + clump method
###

library(ggplot2)
library(cowplot)

All_res$Method&lt;-factor(All_res$Method, levels=unique(All_res$Method))

plots&lt;-list()
for(i in 1:4){
plots[[pheno[i]]] &lt;- ggplot( All_res[All_res$Phenotype==pheno[i],], aes(x=Method, y=CrossVal_R, fill=Group)) +
                      geom_bar(stat=&quot;identity&quot;, position=position_dodge(preserve = &quot;single&quot;), width = 0.7, colour=&#39;black&#39;) +
                      geom_errorbar(aes(ymin=CrossVal_R-CrossVal_R_SE, ymax=CrossVal_R+CrossVal_R_SE), width=.4, position=position_dodge(width = 0.7, preserve = &quot;single&quot;)) +
                      labs(y=&quot;Correlation (SE)&quot;, x=&#39;&#39;, title=pheno[i]) +
                      coord_cartesian(ylim=c(min(All_res$CrossVal_R[All_res$Phenotype==pheno[i]])-0.02, max(All_res$CrossVal_R[All_res$Phenotype==pheno[i]])+0.025), clip=&quot;on&quot;) +
                              theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

png(&#39;/mnt/lustre/users/k1806347/Analyses/TEDS_outcomes_for_prediction/PRS_method_comp_CrossVal_TEDS.png&#39;, units=&#39;px&#39;, res=300, width=3000, height=2750)
plot_grid(plotlist=plots, ncol = 2)
dev.off()

plots&lt;-list()
for(i in 1:4){
plots[[pheno[i]]] &lt;- ggplot( All_res[All_res$Phenotype==pheno[i],], aes(x=Method, y=IndepVal_R, fill=Group)) +
                      geom_bar(stat=&quot;identity&quot;, position=position_dodge(preserve = &quot;single&quot;), width = 0.7, colour=&#39;black&#39;) +
                      geom_errorbar(aes(ymin=IndepVal_R-IndepVal_R_SE, ymax=IndepVal_R+IndepVal_R_SE), width=.2, position=position_dodge(width = 0.7, preserve = &quot;single&quot;)) +
                      labs(y=&quot;Correlation (SE)&quot;, x=&#39;&#39;, title=pheno[i]) +
                      coord_cartesian(ylim=c(min(All_res$IndepVal_R[All_res$Phenotype==pheno[i]])-0.02, max(All_res$IndepVal_R[All_res$Phenotype==pheno[i]])+0.025), clip=&quot;on&quot;) +
                              theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

png(&#39;/mnt/lustre/users/k1806347/Analyses/TEDS_outcomes_for_prediction/PRS_method_comp_IndepVal_TEDS.png&#39;, units=&#39;px&#39;, res=300, width=3000, height=2750)
plot_grid(plotlist=plots, ncol = 2)
dev.off()

q()
n</code></pre>
</details>
<details>
<p><summary>Show TEDS cross-validation results</summary></p>
<center>
<div class="figure">
<img src="Images/Determine_optimal_polygenic_scoring_approach/PRS_method_comp_CrossVal_TEDS.png" alt="Figure 3: Predictive utility estimated using 10-fold cross-validation" />
<p class="caption">Figure 3: Predictive utility estimated using 10-fold cross-validation</p>
</div>
</details>
<details>
<p><summary>Show TEDS test-validation results</summary></p>
<div class="figure">
<img src="Images/Determine_optimal_polygenic_scoring_approach/PRS_method_comp_IndepVal_TEDS.png" alt="Figure 4: Predictive utility estimated using test set validation" />
<p class="caption">Figure 4: Predictive utility estimated using test set validation</p>
</div>

</details>
<details>
<p><summary>Show TEDS results table</summary></p>
<table>
<caption>Table 2: Correlation between PRS model predictions and observed values in TEDS</caption>
<thead>
<tr class="header">
<th align="left">Phenotype</th>
<th align="left">Method</th>
<th align="left">Group</th>
<th align="left">CrossVal R (SE)</th>
<th align="left">IndepVal R (SE)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Height21</td>
<td align="left">pT</td>
<td align="left">10FCVal</td>
<td align="left">0.382 (0.014)</td>
<td align="left">0.382 (0.028)</td>
</tr>
<tr class="even">
<td align="left">Height21</td>
<td align="left">pT</td>
<td align="left">Multi-PRS</td>
<td align="left">0.397 (0.014)</td>
<td align="left">0.406 (0.028)</td>
</tr>
<tr class="odd">
<td align="left">Height21</td>
<td align="left">pT (non-nested)</td>
<td align="left">10FCVal</td>
<td align="left">0.321 (0.014)</td>
<td align="left">0.333 (0.029)</td>
</tr>
<tr class="even">
<td align="left">Height21</td>
<td align="left">pT (non-nested)</td>
<td align="left">Multi-PRS</td>
<td align="left">0.397 (0.014)</td>
<td align="left">0.403 (0.028)</td>
</tr>
<tr class="odd">
<td align="left">Height21</td>
<td align="left">pT (dense)</td>
<td align="left">10FCVal</td>
<td align="left">0.381 (0.014)</td>
<td align="left">0.378 (0.028)</td>
</tr>
<tr class="even">
<td align="left">Height21</td>
<td align="left">pT (dense)</td>
<td align="left">Multi-PRS</td>
<td align="left">0.395 (0.014)</td>
<td align="left">0.383 (0.028)</td>
</tr>
<tr class="odd">
<td align="left">Height21</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.46 (0.043)</td>
<td align="left">0.495 (0.085)</td>
</tr>
<tr class="even">
<td align="left">Height21</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.37 (0.045)</td>
<td align="left">0.453 (0.087)</td>
</tr>
<tr class="odd">
<td align="left">Height21</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.464 (0.043)</td>
<td align="left">0.463 (0.087)</td>
</tr>
<tr class="even">
<td align="left">Height21</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.455 (0.043)</td>
<td align="left">0.531 (0.083)</td>
</tr>
<tr class="odd">
<td align="left">Height21</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.461 (0.043)</td>
<td align="left">0.504 (0.085)</td>
</tr>
<tr class="even">
<td align="left">Height21</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.453 (0.043)</td>
<td align="left">0.509 (0.084)</td>
</tr>
<tr class="odd">
<td align="left">Height21</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.378 (0.014)</td>
<td align="left">0.37 (0.028)</td>
</tr>
<tr class="even">
<td align="left">BMI21</td>
<td align="left">pT</td>
<td align="left">10FCVal</td>
<td align="left">0.319 (0.015)</td>
<td align="left">0.302 (0.03)</td>
</tr>
<tr class="odd">
<td align="left">BMI21</td>
<td align="left">pT</td>
<td align="left">Multi-PRS</td>
<td align="left">0.32 (0.015)</td>
<td align="left">0.304 (0.03)</td>
</tr>
<tr class="even">
<td align="left">BMI21</td>
<td align="left">pT (non-nested)</td>
<td align="left">10FCVal</td>
<td align="left">0.212 (0.015)</td>
<td align="left">0.183 (0.03)</td>
</tr>
<tr class="odd">
<td align="left">BMI21</td>
<td align="left">pT (non-nested)</td>
<td align="left">Multi-PRS</td>
<td align="left">0.316 (0.015)</td>
<td align="left">0.301 (0.03)</td>
</tr>
<tr class="even">
<td align="left">BMI21</td>
<td align="left">pT (dense)</td>
<td align="left">10FCVal</td>
<td align="left">0.28 (0.015)</td>
<td align="left">0.272 (0.03)</td>
</tr>
<tr class="odd">
<td align="left">BMI21</td>
<td align="left">pT (dense)</td>
<td align="left">Multi-PRS</td>
<td align="left">0.318 (0.015)</td>
<td align="left">0.292 (0.03)</td>
</tr>
<tr class="even">
<td align="left">BMI21</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.343 (0.015)</td>
<td align="left">0.378 (0.029)</td>
</tr>
<tr class="odd">
<td align="left">BMI21</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.271 (0.015)</td>
<td align="left">0.302 (0.03)</td>
</tr>
<tr class="even">
<td align="left">BMI21</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.349 (0.015)</td>
<td align="left">0.391 (0.029)</td>
</tr>
<tr class="odd">
<td align="left">BMI21</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.343 (0.015)</td>
<td align="left">0.366 (0.029)</td>
</tr>
<tr class="even">
<td align="left">BMI21</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.335 (0.015)</td>
<td align="left">0.364 (0.029)</td>
</tr>
<tr class="odd">
<td align="left">BMI21</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.345 (0.015)</td>
<td align="left">0.37 (0.029)</td>
</tr>
<tr class="even">
<td align="left">BMI21</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.329 (0.015)</td>
<td align="left">0.349 (0.029)</td>
</tr>
<tr class="odd">
<td align="left">GCSE</td>
<td align="left">pT</td>
<td align="left">10FCVal</td>
<td align="left">0.367 (0.012)</td>
<td align="left">0.351 (0.025)</td>
</tr>
<tr class="even">
<td align="left">GCSE</td>
<td align="left">pT</td>
<td align="left">Multi-PRS</td>
<td align="left">0.372 (0.012)</td>
<td align="left">0.362 (0.024)</td>
</tr>
<tr class="odd">
<td align="left">GCSE</td>
<td align="left">pT (non-nested)</td>
<td align="left">10FCVal</td>
<td align="left">0.254 (0.013)</td>
<td align="left">0.234 (0.025)</td>
</tr>
<tr class="even">
<td align="left">GCSE</td>
<td align="left">pT (non-nested)</td>
<td align="left">Multi-PRS</td>
<td align="left">0.371 (0.012)</td>
<td align="left">0.361 (0.024)</td>
</tr>
<tr class="odd">
<td align="left">GCSE</td>
<td align="left">pT (dense)</td>
<td align="left">10FCVal</td>
<td align="left">0.366 (0.012)</td>
<td align="left">0.348 (0.025)</td>
</tr>
<tr class="even">
<td align="left">GCSE</td>
<td align="left">pT (dense)</td>
<td align="left">Multi-PRS</td>
<td align="left">0.372 (0.012)</td>
<td align="left">0.362 (0.024)</td>
</tr>
<tr class="odd">
<td align="left">GCSE</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.333 (0.012)</td>
<td align="left">0.315 (0.025)</td>
</tr>
<tr class="even">
<td align="left">GCSE</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.402 (0.012)</td>
<td align="left">0.37 (0.024)</td>
</tr>
<tr class="odd">
<td align="left">GCSE</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.404 (0.012)</td>
<td align="left">0.374 (0.024)</td>
</tr>
<tr class="even">
<td align="left">GCSE</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.399 (0.012)</td>
<td align="left">0.372 (0.024)</td>
</tr>
<tr class="odd">
<td align="left">GCSE</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.395 (0.012)</td>
<td align="left">0.375 (0.024)</td>
</tr>
<tr class="even">
<td align="left">GCSE</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.404 (0.012)</td>
<td align="left">0.379 (0.024)</td>
</tr>
<tr class="odd">
<td align="left">GCSE</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.397 (0.012)</td>
<td align="left">0.36 (0.024)</td>
</tr>
<tr class="even">
<td align="left">ADHD</td>
<td align="left">pT</td>
<td align="left">10FCVal</td>
<td align="left">0.116 (0.013)</td>
<td align="left">0.113 (0.025)</td>
</tr>
<tr class="odd">
<td align="left">ADHD</td>
<td align="left">pT</td>
<td align="left">Multi-PRS</td>
<td align="left">0.116 (0.013)</td>
<td align="left">0.127 (0.025)</td>
</tr>
<tr class="even">
<td align="left">ADHD</td>
<td align="left">pT (non-nested)</td>
<td align="left">10FCVal</td>
<td align="left">0.082 (0.013)</td>
<td align="left">0.081 (0.025)</td>
</tr>
<tr class="odd">
<td align="left">ADHD</td>
<td align="left">pT (non-nested)</td>
<td align="left">Multi-PRS</td>
<td align="left">0.114 (0.013)</td>
<td align="left">0.125 (0.025)</td>
</tr>
<tr class="even">
<td align="left">ADHD</td>
<td align="left">pT (dense)</td>
<td align="left">10FCVal</td>
<td align="left">0.099 (0.013)</td>
<td align="left">0.122 (0.025)</td>
</tr>
<tr class="odd">
<td align="left">ADHD</td>
<td align="left">pT (dense)</td>
<td align="left">Multi-PRS</td>
<td align="left">0.102 (0.013)</td>
<td align="left">0.121 (0.025)</td>
</tr>
<tr class="even">
<td align="left">ADHD</td>
<td align="left">lassosum</td>
<td align="left">PseudoVal</td>
<td align="left">0.08 (0.013)</td>
<td align="left">0.114 (0.025)</td>
</tr>
<tr class="odd">
<td align="left">ADHD</td>
<td align="left">lassosum</td>
<td align="left">10FCVal</td>
<td align="left">0.135 (0.012)</td>
<td align="left">0.129 (0.025)</td>
</tr>
<tr class="even">
<td align="left">ADHD</td>
<td align="left">lassosum</td>
<td align="left">Multi-PRS</td>
<td align="left">0.133 (0.012)</td>
<td align="left">0.138 (0.025)</td>
</tr>
<tr class="odd">
<td align="left">ADHD</td>
<td align="left">PRScs</td>
<td align="left">10FCVal</td>
<td align="left">0.13 (0.012)</td>
<td align="left">0.149 (0.025)</td>
</tr>
<tr class="even">
<td align="left">ADHD</td>
<td align="left">PRScs</td>
<td align="left">PseudoVal</td>
<td align="left">0.125 (0.012)</td>
<td align="left">0.122 (0.025)</td>
</tr>
<tr class="odd">
<td align="left">ADHD</td>
<td align="left">PRScs</td>
<td align="left">Multi-PRS</td>
<td align="left">0.129 (0.012)</td>
<td align="left">0.144 (0.025)</td>
</tr>
<tr class="even">
<td align="left">ADHD</td>
<td align="left">SBLUP</td>
<td align="left">PseudoVal</td>
<td align="left">0.128 (0.012)</td>
<td align="left">0.145 (0.025)</td>
</tr>
</tbody>
</table>
</details>
<p><br/></p>
<hr />
</div>
</div>
<div id="discussion" class="section level1">
<h1><span class="header-section-number">5</span> Discussion</h1>
<p>This study has replicated previous findings that shrinkage of GWAS summary statistics using lassosum or PRScs can increase the variance explained by subsequent PRSs. Interestingly predicting the optimal shrinkage paramter via pseudovalidation is suboptimal for lassosum, with selection of the shrinkage parameter by formal cross validation providing substantial improvements the variance explained by the PRS. In contrast psudovalidation, or fully bayesian mode, implemented by PRScs performs well, providing PRSs with a predictive utility close to those derived using a shrinkage parameter identified via cross validation.</p>
<p>This study also reports that use of an elastic net to model model PRSs, based on a range of shrinkage paramters provides the optimal variance explained for all methods and outcomes. However, the improvement in prediction is small, and computational burden of generating multiple PRSs, and modelling them in an elastic net is substantial. Furthermore, as more predictors are included in the model, the likelihood of overfitting increases, particularly in smaller samples.</p>
<p><br/></p>
<hr />
</div>
<div id="conclusion" class="section level1">
<h1><span class="header-section-number">6</span> Conclusion</h1>
<p>Based on our results we think suggest the use of PRScs using only the pseudovalidated, or fully bayesian, global shrinkage parameter, as this provides near optimal prediction whilst reducing computional burden and risk of overfitting.</p>
<p><br/></p>
<hr />
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
