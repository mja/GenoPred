<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Evaluation of Functionally-Informed polygenic Scores</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">GenoPred</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/opain/GenoPred">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Evaluation of Functionally-Informed polygenic Scores</h1>

</div>


<style>
p.caption {
  font-size: 1.5em;
}
</style>
<style type="text/css">
pre code, pre, code {
  white-space: pre !important;
  overflow-x: scroll !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}
</style>
<hr />
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Polygenic scores are a useful research tool and a promising oppurtunity for personalised medicine. A polygenic score is calculated for each individual as the effect size-weighted sum of alleles that an individual carries. The effect size of each variant is most often estimated using a genome-wide association study (GWAS), which uses regression to estimate the association of each variant to a given phenotype. The predictive utility of polygenic scores can be increased by incorporating prior distributions on causal effect sizes, thereby reducing the signal to noise ratio. The estimated polygenicity and heritability of a given phenotype is a common approach for improving the predictive utility of polygenic scores. However, prior distributions can also be derived by considering whether a variant is within a functional group associated with the phenotype. A recent method called LDPred-funct adapts the bayesian shrinkage method of LDPred to incoporate the prior likelihood of causality based on functional enrichment scores. Further research is required to evaluate alternative strategies that integrate the functional effect of genetic variation when calculating polygenic scores.</p>
<p>A mechanism explaining a large proportion of common genetic associations is the regulation of gene expression. Expression quantitative trait loci (eQTL) studies have idenitifed many genetic variants associated with differential gene expression. Integration of eQTL and GWAS associations enables inference of gene expression changes associated with the GWAS phenotype, an approach called transcriptome-wide association study (TWAS). TWAS aggregates the effect of genetic associations in a functionally-informed manner to higlight associated up-/down-regulated genes within a specific tissue, cell type and developmental stage. TWAS is able to idenitfy novel associations by considering a variants effect within specific spatio-temporal context. This approach has been useful for idenitfying plausible candidate genes for follow-up within an experitmental context.</p>
<p>There has been limited research investigting the predictive utility of polygenic scores that consider the effect of each variant on gene expression. Stratifying gentic variation based on whether variants are eQTLs when calcualting polygenic scores has shown eQTL polygenic scores explain a disproptionaite amount of variance compared to non-eQTL variants. Furthermore, a combination of functionally agnostic polygenic scores and eQTL only polygenic scores has been shown to improve prediction. Most previous studies have used binary definitions indicating whether a variant is an eQTL, often not considering the spatio-temporal context of the eQTL association. On study used a more sophisticated approach, here referred to as gene-expression risk scores (GeRS), which considers the joint effect of variation on each gene expression expression within specific spatio-temporal context. GeRS are calculated as the sum of TWAS-based effect sizes weighted by the predicted expression for an individual. GeRSs were shown to significantly predict schizophrenia, with gene expression risk scores derived using prefrontal cortex eQTL data explaining the most variance but a model containing GeRS based on multiple tissues improving prediction. The variance explained by GeRS was less than polygenic scores based on the same GWAS summary statistics because they only capture associations mediated through cis-eQTL associations. However, whether GeRS can improve prediction in combination with polygenic scores was not investigated.</p>
<p>This study evaluates the predictive utility of GeRS calculated using several strategies. The predictive utility of models containing polygenic scores and GeRS is also investigated. Comparison to alternative functionally-agnostic and functionally-informed polygenic scoring methods is performed.</p>
<p><br/></p>
<hr />
</div>
<div id="aims" class="section level1">
<h1><span class="header-section-number">2</span> Aims</h1>
<ul>
<li>Evaluate the predictive utility of GeRS based on a single eQTL data source.</li>
<li>Evaluate models combining GeRS derived eQTL data from multiple tissues and developmental stages.</li>
<li>Determine whether GeRS can improve prediction when in combination with polygenic scores.</li>
<li>Compare GeRs models with other polygenic scoring methods.</li>
</ul>
<p><br/></p>
<hr />
</div>
<div id="methods" class="section level1">
<h1><span class="header-section-number">3</span> Methods</h1>
<div id="samples" class="section level2">
<h2><span class="header-section-number">3.1</span> Samples</h2>
<ul>
<li>UK Biobank</li>
<li>TEDS</li>
</ul>
</div>
<div id="outcomes" class="section level2">
<h2><span class="header-section-number">3.2</span> Outcomes</h2>
<ul>
<li>UK Biobank
<ul>
<li>Depression (binary)</li>
<li>Intelligence (continuous)</li>
<li>Body mass index (BMI - continuous)</li>
<li>Height (continuous)</li>
<li>Coronary Artery Disease (CAD - Binary)</li>
<li>Type II Diabetes (T2D - Binary)</li>
<li>Inflammatory Bowel Disorder (IBD - Binary)</li>
<li>Rheumatoid arthritis (RheuArth - Binary)</li>
</ul></li>
<li>TEDS
<ul>
<li>ADHD traits (continuous)</li>
<li>Height (continuous)</li>
<li>Body mass index (BMI - continuous)</li>
<li>GCSE scores (continuous)</li>
</ul></li>
</ul>
<p>Note. Multiple Slerosis in UK Biobank was not included due to insufficent SNP data in the corresponding GWAS for TWAS.</p>
</div>
<div id="genotypic-data" class="section level2">
<h2><span class="header-section-number">3.3</span> Genotypic data</h2>
<p>Both target sample underwent stringent quality control prior to imputation using the HRC-reference. After imputation, genotypes were converted to PLINK hard-calls, and only HapMap3 SNPs were retained. Eureopean individuals within the target samples were identified and retained if they were within the 3SD of the 1KG European mean of the first 100 principal components.</p>
</div>
<div id="gwas-summary-statistics" class="section level2">
<h2><span class="header-section-number">3.4</span> GWAS summary statistics</h2>
<p>For each target phenotype, the largest independent phenotype-matched GWAS was selected for calculating polygenic scores. More information can be found in the table below.</p>
<details>
<p><summary>Preparing GWAS sumstats table for UK Biobank phenotypes</summary></p>
<pre class="bash"><code>
module add apps/R/3.6.0
R

source(&#39;/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config&#39;)

library(data.table)

pheno&lt;-fread(&#39;/users/k1806347/brc_scratch/Data/GWAS_sumstats/QC_sumstats_list_031218.csv&#39;)

ukb_pheno=c(&#39;Depression&#39;,&#39;Intelligence&#39;,&#39;BMI&#39;,&#39;Height&#39;,&#39;T2D&#39;,&#39;CAD&#39;,&#39;IBD&#39;,&#39;MultiScler&#39;,&#39;RheuArth&#39;)
ukb_gwas=c(&#39;DEPR06&#39;,&#39;COLL01&#39;,&#39;BODY03&#39;,&#39;HEIG03&#39;,&#39;DIAB05&#39;,&#39;COAD01&#39;,&#39;CROH01&#39;,&#39;SCLE02&#39;,&#39;RHEU01&#39;)
ukb_prev=c(0.15,NA,NA,NA,0.05,0.03,0.013,0.00164,0.005)
ukb_dat&lt;-data.frame(pheno=ukb_pheno,gwas=ukb_gwas,prev=ukb_prev)

pheno_ukb&lt;-pheno[(pheno$Code %in% ukb_gwas),]
pheno_ukb&lt;-pheno_ukb[,c(&#39;Code&#39;,&#39;trait&#39;,&#39;year&#39;,&#39;PMID&#39;,&#39;Ncases&#39;,&#39;Ncontrols&#39;,&#39;sample_size_discovery&#39;,&#39;h2 observed&#39;,&#39;h2 se&#39;,&#39;lambda GC&#39;,&#39;intercept&#39;,&#39;intercept se&#39;)]
names(pheno_ukb)&lt;-c(&#39;Code&#39;,&#39;trait&#39;,&#39;year&#39;,&#39;PMID&#39;,&#39;Ncases&#39;,&#39;Ncontrols&#39;,&#39;sample_size_discovery&#39;,&#39;h2_obs&#39;,&#39;h2_se&#39;,&#39;lambda&#39;,&#39;intercept&#39;,&#39;intercept_se&#39;)

pheno_ukb$pop_prev&lt;-ukb_dat$prev[match(pheno_ukb$Code, ukb_dat$gwas)]
pheno_ukb$Target_Phenotype&lt;-ukb_dat$pheno[match(pheno_ukb$Code, ukb_dat$gwas)]
pheno_ukb$Ncases&lt;-as.numeric(gsub(&#39;,&#39;,&#39;&#39;,pheno_ukb$Ncases))
pheno_ukb$Ncontrols&lt;-as.numeric(gsub(&#39;,&#39;,&#39;&#39;,pheno_ukb$Ncontrols))
pheno_ukb$samp_prev&lt;-pheno_ukb$Ncases/(pheno_ukb$Ncases+pheno_ukb$Ncontrols)

h2l_R2 &lt;- function(k, r2, p) {
  # K baseline disease risk
  # r2 from a linear regression model attributable to genomic profile risk score
  # P proportion of sample that are cases
  # calculates proportion of variance explained on the liability scale
  #from ABC at http://www.complextraitgenomics.com/software/
  #Lee SH, Goddard ME, Wray NR, Visscher PM. (2012) A better coefficient of determination for genetic profile analysis. Genet Epidemiol. 2012 Apr;36(3):214-24.
  x= qnorm(1-k)
  z= dnorm(x)
  i=z/k
  C= k*(1-k)*k*(1-k)/(z^2*p*(1-p))
  theta= i*((p-k)/(1-k))*(i*((p-k)/(1-k))-x)
  h2l_R2 = C*r2 / (1 + C*theta*r2)
}

se_h2l_R2 &lt;- function(k,h2,se, p) {
  # K baseline disease risk
  # r2 from a linear regression model attributable to genomic profile risk score
  # P proportion of sample that are cases
  # calculates proportion of variance explained on the liability scale
  #from ABC at http://www.complextraitgenomics.com/software/
  #Lee SH, Goddard ME, Wray NR, Visscher PM. (2012) A better coefficient of determination for genetic profile analysis. Genet Epidemiol. 2012 Apr;36(3):214-24.

  #SE on the liability (From a Taylor series expansion)
  #var(h2l_r2) = [d(h2l_r2)/d(R2v)]^2*var(R2v) with d being calculus differentiation
  x= qnorm(1-k)
  z= dnorm(x)
  i=z/k
  C= k*(1-k)*k*(1-k)/(z^2*p*(1-p))
  theta= i*((p-k)/(1-k))*(i*((p-k)/(1-k))-x)
  se_h2l_R2 = C*(1-h2*theta)*se
}

pheno_ukb$h2_obs&lt;-as.numeric(pheno_ukb$h2_obs)
pheno_ukb$h2_se&lt;-as.numeric(pheno_ukb$h2_se)

pheno_ukb$h2_liab&lt;-round(h2l_R2(k=pheno_ukb$pop_prev, r2=pheno_ukb$h2_obs, p=pheno_ukb$samp_prev),3)
pheno_ukb$h2_liab_se&lt;-round(se_h2l_R2(k=pheno_ukb$pop_prev,h2=pheno_ukb$h2_obs,se=pheno_ukb$h2_se, p=pheno_ukb$samp_prev),3)

pheno_ukb$h2_obs&lt;-paste0(pheno_ukb$h2_obs,&quot; (&quot;, pheno_ukb$h2_se,&quot;)&quot;)
pheno_ukb$h2_se&lt;-NULL
pheno_ukb$h2_liab[!is.na(pheno_ukb$Ncases)]&lt;-paste0(pheno_ukb$h2_liab[!is.na(pheno_ukb$Ncases)],&quot; (&quot;, pheno_ukb$h2_liab_se[!is.na(pheno_ukb$Ncases)],&quot;)&quot;)
pheno_ukb$h2_liab_se&lt;-NULL
pheno_ukb$intercept&lt;-paste0(pheno_ukb$intercept,&quot; (&quot;, pheno_ukb$intercept_se,&quot;)&quot;)
pheno_ukb$intercept_se&lt;-NULL

pheno_ukb$trait&lt;-c(&#39;BMI&#39;,&#39;CAD&#39;,&#39;College Completion&#39;,&quot;Crohn&#39;s Disease&quot;,&#39;Major Depression&#39;,&#39;T2D&#39;,&#39;Height&#39;,&#39;RheuArth&#39;,&#39;MultiScler&#39;)
pheno_ukb&lt;-pheno_ukb[match(ukb_dat$gwas,pheno_ukb$Code),]

pheno_ukb&lt;-pheno_ukb[,c(&#39;Target_Phenotype&#39;,&#39;Code&#39;,&#39;trait&#39;,&#39;year&#39;,&#39;PMID&#39;,&#39;Ncases&#39;,&#39;Ncontrols&#39;,&#39;sample_size_discovery&#39;,&#39;h2_obs&#39;,&#39;h2_liab&#39;,&#39;intercept&#39;,&#39;lambda&#39;)]
names(pheno_ukb)&lt;-c(&#39;Target Phenotype&#39;,&#39;Code&#39;,&#39;GWAS Phenotype&#39;,&#39;Year&#39;,&#39;PMID&#39;,&#39;Ncase&#39;,&#39;Ncontrol&#39;,&#39;N&#39;,&#39;h2_obs&#39;,&#39;h2_liab&#39;,&#39;Intercept&#39;,&#39;Lambda&#39;)

write.csv(pheno_ukb, &#39;/users/k1806347/brc_scratch/Data/GWAS_sumstats/UKBB_phenotype_GWAS_descrip.csv&#39;, row.names=F, quote=F)
q()
n
</code></pre>
</details>
<details>
<p><summary>Show GWAS for UK Biobank phenotypes</summary></p>
<table>
<caption>GWAS used for each UK Biobank phenotype</caption>
<thead>
<tr class="header">
<th align="left">Target Phenotype</th>
<th align="left">Code</th>
<th align="left">GWAS Phenotype</th>
<th align="right">Year</th>
<th align="right">PMID</th>
<th align="right">Ncase</th>
<th align="right">Ncontrol</th>
<th align="right">N</th>
<th align="left">h2-obs (SE)</th>
<th align="left">h2-liab (SE)</th>
<th align="left">Intercept</th>
<th align="right">Lambda</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Depression</td>
<td align="left">DEPR06</td>
<td align="left">Major Depression</td>
<td align="right">2018</td>
<td align="right">29700475</td>
<td align="right">116404</td>
<td align="right">314990</td>
<td align="right">431394</td>
<td align="left">0.0551 (0.0023)</td>
<td align="left">0.085 (0.004)</td>
<td align="left">1.017 (0.009)</td>
<td align="right">1.3894</td>
</tr>
<tr class="even">
<td align="left">Intelligence</td>
<td align="left">COLL01</td>
<td align="left">College Completion</td>
<td align="right">2013</td>
<td align="right">23722424</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">95427</td>
<td align="left">0.1048 (0.0075)</td>
<td align="left">NA</td>
<td align="left">1.0214 (0.0086)</td>
<td align="right">1.1940</td>
</tr>
<tr class="odd">
<td align="left">BMI</td>
<td align="left">BODY03</td>
<td align="left">BMI</td>
<td align="right">2015</td>
<td align="right">25673413</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">339224</td>
<td align="left">0.1346 (0.0057)</td>
<td align="left">NA</td>
<td align="left">0.7054 (0.0078)</td>
<td align="right">1.1301</td>
</tr>
<tr class="even">
<td align="left">Height</td>
<td align="left">HEIG03</td>
<td align="left">Height</td>
<td align="right">2014</td>
<td align="right">25282103</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">253288</td>
<td align="left">0.312 (0.0141)</td>
<td align="left">NA</td>
<td align="left">1.3254 (0.0185)</td>
<td align="right">2.0007</td>
</tr>
<tr class="odd">
<td align="left">T2D</td>
<td align="left">DIAB05</td>
<td align="left">T2D</td>
<td align="right">2017</td>
<td align="right">28566273</td>
<td align="right">26676</td>
<td align="right">132532</td>
<td align="right">159208</td>
<td align="left">0.0781 (0.0053)</td>
<td align="left">0.124 (0.008)</td>
<td align="left">0.9984 (0.0083)</td>
<td align="right">1.1459</td>
</tr>
<tr class="even">
<td align="left">CAD</td>
<td align="left">COAD01</td>
<td align="left">CAD</td>
<td align="right">2015</td>
<td align="right">26343387</td>
<td align="right">60801</td>
<td align="right">123504</td>
<td align="right">184305</td>
<td align="left">0.0661 (0.0045)</td>
<td align="left">0.057 (0.004)</td>
<td align="left">0.8875 (0.0074)</td>
<td align="right">1.0466</td>
</tr>
<tr class="odd">
<td align="left">IBD</td>
<td align="left">CROH01</td>
<td align="left">Crohn’s Disease</td>
<td align="right">2015</td>
<td align="right">26192919</td>
<td align="right">5956</td>
<td align="right">14927</td>
<td align="right">20883</td>
<td align="left">0.4751 (0.0538)</td>
<td align="left">0.542 (0.059)</td>
<td align="left">1.0316 (0.0092)</td>
<td align="right">1.1396</td>
</tr>
<tr class="even">
<td align="left">MultiScler</td>
<td align="left">SCLE02</td>
<td align="left">MultiScler</td>
<td align="right">2011</td>
<td align="right">21833088</td>
<td align="right">9772</td>
<td align="right">17376</td>
<td align="right">27148</td>
<td align="left">0.048 (0.0263)</td>
<td align="left">0.021 (0.012)</td>
<td align="left">1.0602 (0.0087)</td>
<td align="right">1.0375</td>
</tr>
<tr class="odd">
<td align="left">RheuArth</td>
<td align="left">RHEU01</td>
<td align="left">RheuArth</td>
<td align="right">2014</td>
<td align="right">24390342</td>
<td align="right">19234</td>
<td align="right">60565</td>
<td align="right">79799</td>
<td align="left">0.1018 (0.013)</td>
<td align="left">0.072 (0.01)</td>
<td align="left">0.9532 (0.0078)</td>
<td align="right">1.0466</td>
</tr>
</tbody>
</table>
</details>
<details>
<p><summary>Preparing GWAS sumstats table for TEDS phenotypes</summary></p>
<pre class="bash"><code>
module add apps/R/3.6.0
R

source(&#39;/users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Phenotype_prep.config&#39;)

library(data.table)

pheno&lt;-fread(&#39;/users/k1806347/brc_scratch/Data/GWAS_sumstats/QC_sumstats_list_031218.csv&#39;)

teds_pheno=c(&#39;Height21&#39;, &#39;BMI21&#39;, &#39;GCSE&#39;, &#39;ADHD&#39;)
teds_gwas=c(&#39;HEIG03&#39;, &#39;BODY11&#39;, &#39;EDUC03&#39;, &#39;ADHD04&#39;)
teds_prev=c(NA,NA,NA,0.05)
teds_dat&lt;-data.frame(pheno=teds_pheno,gwas=teds_gwas,prev=teds_prev)

pheno_teds&lt;-pheno[(pheno$Code %in% teds_gwas),]
pheno_teds&lt;-pheno_teds[,c(&#39;Code&#39;,&#39;trait&#39;,&#39;year&#39;,&#39;PMID&#39;,&#39;Ncases&#39;,&#39;Ncontrols&#39;,&#39;sample_size_discovery&#39;,&#39;h2 observed&#39;,&#39;h2 se&#39;,&#39;lambda GC&#39;,&#39;intercept&#39;,&#39;intercept se&#39;)]
names(pheno_teds)&lt;-c(&#39;Code&#39;,&#39;trait&#39;,&#39;year&#39;,&#39;PMID&#39;,&#39;Ncases&#39;,&#39;Ncontrols&#39;,&#39;sample_size_discovery&#39;,&#39;h2_obs&#39;,&#39;h2_se&#39;,&#39;lambda&#39;,&#39;intercept&#39;,&#39;intercept_se&#39;)

pheno_teds$pop_prev&lt;-teds_dat$prev[match(pheno_teds$Code, teds_dat$gwas)]
pheno_teds$Target_Phenotype&lt;-teds_dat$pheno[match(pheno_teds$Code, teds_dat$gwas)]
pheno_teds$Ncases&lt;-as.numeric(gsub(&#39;,&#39;,&#39;&#39;,pheno_teds$Ncases))
pheno_teds$Ncontrols&lt;-as.numeric(gsub(&#39;,&#39;,&#39;&#39;,pheno_teds$Ncontrols))
pheno_teds$samp_prev&lt;-pheno_teds$Ncases/(pheno_teds$Ncases+pheno_teds$Ncontrols)

h2l_R2 &lt;- function(k, r2, p) {
  # K baseline disease risk
  # r2 from a linear regression model attributable to genomic profile risk score
  # P proportion of sample that are cases
  # calculates proportion of variance explained on the liability scale
  #from ABC at http://www.complextraitgenomics.com/software/
  #Lee SH, Goddard ME, Wray NR, Visscher PM. (2012) A better coefficient of determination for genetic profile analysis. Genet Epidemiol. 2012 Apr;36(3):214-24.
  x= qnorm(1-k)
  z= dnorm(x)
  i=z/k
  C= k*(1-k)*k*(1-k)/(z^2*p*(1-p))
  theta= i*((p-k)/(1-k))*(i*((p-k)/(1-k))-x)
  h2l_R2 = C*r2 / (1 + C*theta*r2)
}

se_h2l_R2 &lt;- function(k,h2,se, p) {
  # K baseline disease risk
  # r2 from a linear regression model attributable to genomic profile risk score
  # P proportion of sample that are cases
  # calculates proportion of variance explained on the liability scale
  #from ABC at http://www.complextraitgenomics.com/software/
  #Lee SH, Goddard ME, Wray NR, Visscher PM. (2012) A better coefficient of determination for genetic profile analysis. Genet Epidemiol. 2012 Apr;36(3):214-24.

  #SE on the liability (From a Taylor series expansion)
  #var(h2l_r2) = [d(h2l_r2)/d(R2v)]^2*var(R2v) with d being calculus differentiation
  x= qnorm(1-k)
  z= dnorm(x)
  i=z/k
  C= k*(1-k)*k*(1-k)/(z^2*p*(1-p))
  theta= i*((p-k)/(1-k))*(i*((p-k)/(1-k))-x)
  se_h2l_R2 = C*(1-h2*theta)*se
}

pheno_teds$h2_obs&lt;-as.numeric(pheno_teds$h2_obs)
pheno_teds$h2_se&lt;-as.numeric(pheno_teds$h2_se)

pheno_teds$h2_liab&lt;-round(h2l_R2(k=pheno_teds$pop_prev, r2=pheno_teds$h2_obs, p=pheno_teds$samp_prev),3)
pheno_teds$h2_liab_se&lt;-round(se_h2l_R2(k=pheno_teds$pop_prev,h2=pheno_teds$h2_obs,se=pheno_teds$h2_se, p=pheno_teds$samp_prev),3)

pheno_teds$h2_obs&lt;-paste0(pheno_teds$h2_obs,&quot; (&quot;, pheno_teds$h2_se,&quot;)&quot;)
pheno_teds$h2_se&lt;-NULL
pheno_teds$h2_liab[!is.na(pheno_teds$Ncases)]&lt;-paste0(pheno_teds$h2_liab[!is.na(pheno_teds$Ncases)],&quot; (&quot;, pheno_teds$h2_liab_se[!is.na(pheno_teds$Ncases)],&quot;)&quot;)
pheno_teds$h2_liab_se&lt;-NULL
pheno_teds$intercept&lt;-paste0(pheno_teds$intercept,&quot; (&quot;, pheno_teds$intercept_se,&quot;)&quot;)
pheno_teds$intercept_se&lt;-NULL

pheno_teds$trait&lt;-c(&quot;ADHD (mixed ancestry)&quot;,&#39;BMI&#39;,&#39;Educational Attainment&#39;,&#39;Height&#39;)
pheno_teds&lt;-pheno_teds[match(teds_dat$gwas,pheno_teds$Code),]

pheno_teds&lt;-pheno_teds[,c(&#39;Target_Phenotype&#39;,&#39;Code&#39;,&#39;trait&#39;,&#39;year&#39;,&#39;PMID&#39;,&#39;Ncases&#39;,&#39;Ncontrols&#39;,&#39;sample_size_discovery&#39;,&#39;h2_obs&#39;,&#39;h2_liab&#39;,&#39;intercept&#39;,&#39;lambda&#39;)]
names(pheno_teds)&lt;-c(&#39;Target Phenotype&#39;,&#39;Code&#39;,&#39;GWAS Phenotype&#39;,&#39;Year&#39;,&#39;PMID&#39;,&#39;Ncase&#39;,&#39;Ncontrol&#39;,&#39;N&#39;,&#39;h2_obs&#39;,&#39;h2_liab&#39;,&#39;Intercept&#39;,&#39;Lambda&#39;)

pheno_teds$PMID[2]&lt;-30124842
pheno_teds$PMID[4]&lt;-30478444

write.csv(pheno_teds, &#39;/users/k1806347/brc_scratch/Data/GWAS_sumstats/TEDS_phenotype_GWAS_descrip.csv&#39;, row.names=F, quote=F)
q()
n
</code></pre>
</details>
<details>
<p><summary>Show GWAS for TEDS phenotypes</summary></p>
<table>
<caption>GWAS used for each TEDS phenotype</caption>
<thead>
<tr class="header">
<th align="left">Target Phenotype</th>
<th align="left">Code</th>
<th align="left">GWAS Phenotype</th>
<th align="right">Year</th>
<th align="right">PMID</th>
<th align="right">Ncase</th>
<th align="right">Ncontrol</th>
<th align="right">N</th>
<th align="left">h2-obs (SE)</th>
<th align="left">h2-liab (SE)</th>
<th align="left">Intercept</th>
<th align="right">Lambda</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Height21</td>
<td align="left">HEIG03</td>
<td align="left">Height</td>
<td align="right">2014</td>
<td align="right">25282103</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">253288</td>
<td align="left">0.312 (0.0141)</td>
<td align="left">NA</td>
<td align="left">1.3254 (0.0185)</td>
<td align="right">2.0007</td>
</tr>
<tr class="even">
<td align="left">BMI21</td>
<td align="left">BODY11</td>
<td align="left">BMI</td>
<td align="right">2018</td>
<td align="right">30124842</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">693529</td>
<td align="left">0.1576 (0.0048)</td>
<td align="left">NA</td>
<td align="left">1.1988 (0.0186)</td>
<td align="right">2.5641</td>
</tr>
<tr class="odd">
<td align="left">GCSE</td>
<td align="left">EDUC03</td>
<td align="left">Educational Attainment</td>
<td align="right">2018</td>
<td align="right">30038396</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">766345</td>
<td align="left">0.1066 (0.0026)</td>
<td align="left">NA</td>
<td align="left">1.0301 (0.0137)</td>
<td align="right">2.0940</td>
</tr>
<tr class="even">
<td align="left">ADHD</td>
<td align="left">ADHD04</td>
<td align="left">ADHD (mixed ancestry)</td>
<td align="right">2017</td>
<td align="right">30478444</td>
<td align="right">20183</td>
<td align="right">35191</td>
<td align="right">55374</td>
<td align="left">0.3635 (0.0227)</td>
<td align="left">0.426 (0.026)</td>
<td align="left">1.0295 (0.0096)</td>
<td align="right">1.2431</td>
</tr>
</tbody>
</table>
</details>
<p><br/></p>
</div>
<div id="gene-expression-risk-scores-gers" class="section level2">
<h2><span class="header-section-number">3.5</span> Gene expression risk scores (GeRS)</h2>
<p>TWAS integrates GWAS summary statistics with multi-SNP predictors of gene expression (SNP-weights) to infer gene expression associations. Multi-SNP predictors in combination with individual-level genotypie data can also be used to predict the expression level of genes within an each individual. GeRS are calculated as the TWAS-effect size weighted sum of predicted gene expression levels in each individual.</p>
<p>This study used SNP-weights derived from multiple panels capturing eQTL effects across a range of adult tissues. SNP-weights were downloaded from the FUSION website. TWAS was performed using FUSION and SNP-weights were used to calculated predicted expression levels using PLINK. GeRS for each panel were then calculated in R. To account for the correlation between the predicted expression of nearby features due to LD, features clumping was used to remove features within X Mb of lead features with a predicted expression correlation of X. Due to the complex LD structure within the MHC region, only the lead feature within this region was retained.</p>
<p>TWAS, gene expression prediction and GeRS calculations were carried out using LD and MAF estimations from an ancestry matched reference genotype dataset. The same SNP-weights are used to predict expression levels regardless of the target samples, using MAF imputation to account for missing variation. Predicted expression levels for each gene are then standardised based on the ancestry-matched mean and standard deviation of expression. Clumping of features is performed using predicted expression level in the reference sample.</p>
<p>The code used to prepare the reference data required for calculating GeRS can be found <a href="https://opain.github.io/GenoPred/Pipeline_prep.html#5_functionally-informed_polygenic_scoring">here</a>. The code used for calculating predicted expression levels in the target samples can be found <a href="https://opain.github.io/GenoPred/Genotype-based_scoring_in_target_samples.html#4_functionally-informed_polygenic_scoring">here</a></p>
<details>
<p><summary>Calculating GeRS in samples</summary></p>
<pre class="bash"><code>###
# UKBB
###

. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

mkdir -p ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR
&gt; ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/todo.txt

# Create variable listing phenotypes and corresponding GWAS
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)

for i in $(seq 1 8);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

  for weights in $(cat ~/brc_scratch/Data/TWAS_sumstats/FUSION/snp_weight_list.txt);do
    if [ ! -f ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/${weights}/UKBB.w_hm3.EUR.${weights}.${gwas_i}.fiprofile ]; then
      echo $gwas_i $pheno_i $weights &gt;&gt; ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/todo.txt
    fi
  done
  
done

for i in $(seq 1 $(wc -l ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/todo.txt | cut -d &#39; &#39; -f 1));do
gwas=$(awk -v var=&quot;$i&quot; &#39;NR == var {print $1}&#39; ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/todo.txt)
pheno=$(awk -v var=&quot;$i&quot; &#39;NR == var {print $2}&#39; ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/todo.txt)
weights=$(awk -v var=&quot;$i&quot; &#39;NR == var {print $3}&#39; ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/todo.txt)

sbatch -p brc,shared --mem 10G -n 1 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/scaled_functionally_informed_risk_scorer/scaled_functionally_informed_risk_scorer.R \
  --targ_feature_pred ${UKBB_output}/Predicted_expression/FUSION/EUR/${weights}/UKBB.w_hm3.QCd.AllSNP.FUSION.${weights}.predictions.gz \
  --target_keep ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno}.txt \
  --ref_score ${Geno_1KG_dir}/Score_files_for_functionally_informed_risk_scores/${gwas}/1KGPhase3.w_hm3.EUR.FUSION.${gwas}.${weights}.score \
  --ref_scale ${Geno_1KG_dir}/Score_files_for_functionally_informed_risk_scores/${gwas}/1KGPhase3.w_hm3.EUR.FUSION.${gwas}.${weights}.scale \
  --pheno_name ${gwas} \
  --n_cores 1 \
  --pigz ${pigz_binary} \
  --output ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/${weights}/UKBB.w_hm3.EUR.${weights}.${gwas}

sleep 20
done

###
# TEDS
###

. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

mkdir -p ${TEDS_output_dir}/FunctionallyInformedPolygenicScores/EUR
&gt; ${TEDS_output_dir}/FunctionallyInformedPolygenicScores/EUR/todo.txt

# Create variable listing phenotypes and corresponding GWAS
gwas=$(echo HEIG03 EDUC03 ADHD04 BODY11)

for i in $(seq 1 4);do
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

  for weights in $(cat ~/brc_scratch/Data/TWAS_sumstats/FUSION/snp_weight_list.txt);do
    if [ ! -f ${TEDS_output_dir}/FunctionallyInformedPolygenicScores/EUR/${weights}/TEDS.w_hm3.EUR.${weights}.${gwas_i}.fiprofile ]; then
      echo $gwas_i $weights &gt;&gt; ${TEDS_output_dir}/FunctionallyInformedPolygenicScores/EUR/todo.txt
    fi
  done
  
done

for i in $(seq 1 $(wc -l ${TEDS_output_dir}/FunctionallyInformedPolygenicScores/EUR/todo.txt | cut -d &#39; &#39; -f 1));do
gwas=$(awk -v var=&quot;$i&quot; &#39;NR == var {print $1}&#39; ${TEDS_output_dir}/FunctionallyInformedPolygenicScores/EUR/todo.txt)
weights=$(awk -v var=&quot;$i&quot; &#39;NR == var {print $2}&#39; ${TEDS_output_dir}/FunctionallyInformedPolygenicScores/EUR/todo.txt)

sbatch -p brc,shared --mem 10G -n 1 /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/scaled_functionally_informed_risk_scorer/scaled_functionally_informed_risk_scorer.R \
  --targ_feature_pred ${TEDS_output_dir}/Predicted_expression/FUSION/EUR/${weights}/TEDS.w_hm3.QCd.AllSNP.FUSION.${weights}.predictions.gz \
  --ref_score ${Geno_1KG_dir}/Score_files_for_functionally_informed_risk_scores/${gwas}/1KGPhase3.w_hm3.EUR.FUSION.${gwas}.${weights}.score \
  --ref_scale ${Geno_1KG_dir}/Score_files_for_functionally_informed_risk_scores/${gwas}/1KGPhase3.w_hm3.EUR.FUSION.${gwas}.${weights}.scale \
  --pheno_name ${gwas} \
  --n_cores 1 \
  --pigz ${pigz_binary} \
  --output ${TEDS_output_dir}/FunctionallyInformedPolygenicScores/EUR/${weights}/TEDS.w_hm3.EUR.${weights}.${gwas}

sleep 5
done
</code></pre>
</details>
<p><br/></p>
</div>
<div id="functionally-informed-polygenic-scoring" class="section level2">
<h2><span class="header-section-number">3.6</span> Functionally-informed polygenic scoring</h2>
<p>Functionally informed polygenic scores were derived as follows:</p>
<ol style="list-style-type: decimal">
<li>TWAS SNP-weight-stratified p-value thresholding and clumping (eQTL pT+clump)</li>
<li>LDPred-funct - Bayesian shrinkage method using LDSC enrichment to derive prior distribution</li>
</ol>
<details>
<p><summary>Calculating GeRS in samples</summary></p>
<pre class="bash"><code># Set required variables
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Create variable listing phenotypes and corresponding GWAS
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)

# Calculate polygenic scores using 1KG reference
for i in $(seq 1 8);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

  sbatch --mem 10G -p brc,shared -J pT_clump /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Scaled_polygenic_scorer/Scaled_polygenic_scorer.R \
    --target_plink_chr ${UKBB_output}/Genotype/Harmonised/UKBB.w_hm3.QCd.AllSNP.chr \
    --target_keep ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --ref_score ${Geno_1KG_dir}/Score_files_for_poylygenic_stratified_TWAS_Gene/${gwas_i}/1KGPhase3.w_hm3.${gwas_i} \
    --ref_scale ${Geno_1KG_dir}/Score_files_for_poylygenic_stratified_TWAS_Gene/${gwas_i}/1KGPhase3.w_hm3.${gwas_i}.EUR.scale \
    --ref_freq_chr ${Geno_1KG_dir}/freq_files/EUR/1KGPhase3.w_hm3.EUR.chr \
    --plink ${plink1_9} \
    --pheno_name ${gwas_i} \
    --output ${UKBB_output}/PRS_for_comparison/1KG_ref/pt_clump_stratified_TWAS_Gene/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}
done
</code></pre>
</details>
<p><br/></p>
</div>
<div id="functionally-agnostic-polygenic-scoring" class="section level2">
<h2><span class="header-section-number">3.7</span> Functionally-agnostic Polygenic scoring</h2>
<p>Polygenic scores were derived using the following methods:</p>
<ol style="list-style-type: decimal">
<li>p-value thresholding and clumping (pT + clump).</li>
<li>lassosum - Lasso-based shrinkage method.</li>
<li>PRScs - Bayesian shrinkage method.</li>
<li>SBLUP - Summary statistic-based BLUP estimates</li>
<li>SBayesR - Bayesian joint estimation method</li>
<li>LDPred - Bayesian joint estimation method</li>
</ol>
<p>Polygenic scores were derived using a reference standardised pipeline. Two references were used for all methods, the European subset of the 1KG reference (<a href="https://opain.github.io/GenoPred/Pipeline_prep.html#4_polygenic_scoring">described here</a>), and an independant subset of 10K European individuals from UK Biobank (<a href="https://opain.github.io/GenoPred/Pipeline_prep_withUKBB_ref.html#3_polygenic_scoring">described here</a>). In brief, all scores were derived using HapMap3 SNPs only, modelling LD based on these references Any HapMap3 missing in the target sample are imputed using the reference estimated allele frequency.</p>
<p>Polygenic scoring in target samples has been previously documented <a href="https://opain.github.io/GenoPred/Determine_optimal_polygenic_scoring_approach.html">here</a></p>
<p><br/></p>
</div>
<div id="estimating-predictive-ability" class="section level2">
<h2><span class="header-section-number">3.8</span> Estimating predictive ability</h2>
<p>Models containing a single predictor were derived using generalised linear model (GLM). Models containing multiple predictors were derived using elastic-net regularisation to reduce the likelihood of overfitting and account for multicollinearity when modelling highly correlated predictors. 10-fold cross validation was performed using 80% of individuals to identify optimal parameters, with subsequent test-set validation in the remaining 20% of individuals to estimate the predictive utility among individuals not included in the parameter selection process.</p>
<p>Model building and evaluation was performed using an Rscript called Model_builder.R (more information <a href="https://github.com/opain/GenoPred/tree/master/Scripts/Model_builder">here</a>).</p>
<div id="uk-biobank" class="section level3">
<h3><span class="header-section-number">3.8.1</span> UK Biobank</h3>
<details>
<p><summary>Single-pT vs. Multi-pT</summary></p>
<pre class="bash"><code>##############################
# Evaluating predictive utility of GeRS across multiple pTs individually and in combination
##############################
# Use blood eQTL data based GeRS
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Make required directories
for pheno_i in $(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth);do
mkdir -p /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withGeRSs
done

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)
weights=YFS.BLOOD.RNAARR

for i in $(seq 1 8);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withGeRSs/UKBB.w_hm3.${weights}.${gwas_i}.EUR-GeRSs.predictor_groups &lt;&lt;EOF
predictors 
${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/${weights}/UKBB.w_hm3.EUR.${weights}.${gwas_i}.fiprofile
EOF

done

# Derive and evaluate models
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03 0.013 0.00164 0.005)
weights=YFS.BLOOD.RNAARR

# 1KG reference
for i in $(seq 1 8);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

sbatch --mem 10G -n 2 -p brc,shared /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
    --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withGeRSs/UKBB.w_hm3.${weights}.${gwas_i}.EUR-GeRSs \
    --n_core 2 \
    --compare_predictors T \
    --assoc T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withGeRSs/UKBB.w_hm3.${weights}.${gwas_i}.EUR-GeRSs.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>Single-tissue vs. Multi-tissue</summary></p>
<pre class="bash"><code>##############################
# Evaluating predictive utility of GeRS across multiple tissues individually and in combination
##############################
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Make required directories
for pheno_i in $(echo Depression Intelligence BMI Height T2D CAD IBD MultiScler RheuArth);do
mkdir -p /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withGeRSs
done

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)
weights=$(cat ${TWAS_rep}/snp_weight_list.txt)

for i in $(seq 1 8);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  
  echo &quot;predictors group&quot; &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withGeRSs/UKBB.w_hm3.AllTissue.${gwas_i}.EUR-GeRSs.predictor_groups

  for weight in ${weights}; do
    echo ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/${weight}/UKBB.w_hm3.EUR.${weight}.${gwas_i}.fiprofile ${weight} &gt;&gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withGeRSs/UKBB.w_hm3.AllTissue.${gwas_i}.EUR-GeRSs.predictor_groups
  done
  
done

# Derive and evaluate models
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03 0.013 0.00164 0.005)
weights=YFS.BLOOD.RNAARR

# 1KG reference
for i in $(seq 1 8);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

sbatch --mem 10G -n 2 -p brc,shared /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
    --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withGeRSs/UKBB.w_hm3.AllTissue.${gwas_i}.EUR-GeRSs \
    --n_core 2 \
    --compare_predictors F \
    --assoc T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withGeRSs/UKBB.w_hm3.AllTissue.${gwas_i}.EUR-GeRSs.predictor_groups
done</code></pre>
</details>
<details>
<p><summary>GeRS + PRS</summary></p>
<pre class="bash"><code>##############################
# Evaluating predictive utility of GeRS and PRS individually and in combination
##############################
. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Make required directories
for pheno_i in $(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth);do
mkdir -p /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRS_and_GeRSs
done

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)
weights=$(cat ${TWAS_rep}/snp_weight_list.txt)

for i in $(seq 1 8);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  
  echo &quot;predictors group&quot; &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRS_and_GeRSs/UKBB.w_hm3.AllTissue.${gwas_i}.EUR-GeRSs.EUR-PRSs.pt_clump.predictor_groups

  for weight in ${weights}; do
    echo ${UKBB_output}/GeRS_for_comparison/1KG_ref/EUR/${weight}/UKBB.w_hm3.EUR.${weight}.${gwas_i}.fiprofile GeRS &gt;&gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRS_and_GeRSs/UKBB.w_hm3.AllTissue.${gwas_i}.EUR-GeRSs.EUR-PRSs.pt_clump.predictor_groups
  done

    echo ${UKBB_output}/PRS_for_comparison/1KG_ref/pt_clump/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}.profiles PRS &gt;&gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRS_and_GeRSs/UKBB.w_hm3.AllTissue.${gwas_i}.EUR-GeRSs.EUR-PRSs.pt_clump.predictor_groups
done

# Derive and evaluate models
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03 0.013 0.00164 0.005)

# 1KG reference
for i in $(seq 1 8);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

sbatch --mem 10G -n 4 -p brc,shared /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
    --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRS_and_GeRSs/UKBB.w_hm3.AllTissue.${gwas_i}.EUR-GeRSs.EUR-PRSs.pt_clump \
    --n_core 4 \
    --compare_predictors F \
    --assoc T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRS_and_GeRSs/UKBB.w_hm3.AllTissue.${gwas_i}.EUR-GeRSs.EUR-PRSs.pt_clump.predictor_groups
done
</code></pre>
</details>
<details>
<p><summary>TWAS gene stratified polygenic score</summary></p>
<pre class="bash"><code>. /users/k1806347/brc_scratch/Software/MyGit/GenoPred/config_used/Target_scoring.config

# Create a file listing the predictors files
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)

for i in $(seq 1 8);do
pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)

cat &gt; /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs-TWAS_gene_stratified.predictor_groups &lt;&lt;EOF
predictors 
${UKBB_output}/PRS_for_comparison/1KG_ref/pt_clump_stratified_TWAS_Gene/${gwas_i}/UKBB.subset.w_hm3.${gwas_i}.profiles
EOF

done

# Derive and evaluate models
pheno=$(echo Depression Intelligence BMI Height T2D CAD IBD RheuArth)
gwas=$(echo DEPR06 COLL01 BODY03 HEIG03 DIAB05 COAD01 CROH01 RHEU01)
prev=$(echo 0.15 NA NA NA 0.05 0.03 0.013 0.00164 0.005)

# 1KG reference
for i in $(seq 1 8);do
  pheno_i=$(echo ${pheno} | cut -f ${i} -d &#39; &#39;)
  pheno_file_i=$(echo ${pheno_file} | cut -f ${i} -d &#39; &#39;)
  gwas_i=$(echo ${gwas} | cut -f ${i} -d &#39; &#39;)
  prev_i=$(echo ${prev} | cut -f ${i} -d &#39; &#39;)

sbatch --mem 10G -n 2 -p brc,shared /users/k1806347/brc_scratch/Software/Rscript.sh /users/k1806347/brc_scratch/Software/MyGit/GenoPred/Scripts/Model_builder/Model_builder.R \
    --pheno ${UKBB_output}/Phenotype/PRS_comp_subset/UKBB.${pheno_i}.txt \
    --keep /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/ukb18177_glanville_post_qc_id_list.UpdateIDs.fam \
    --out /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs-TWAS_gene_stratified \
    --n_core 2 \
    --compare_predictors T \
    --assoc T \
    --outcome_pop_prev ${prev_i} \
    --predictors /users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/${pheno_i}/Association_withPRSs/UKBB.w_hm3.${gwas_i}.EUR-PRSs-TWAS_gene_stratified.predictor_groups
done
</code></pre>
</details>
<p><br/></p>
</div>
<div id="teds" class="section level3">
<h3><span class="header-section-number">3.8.2</span> TEDS</h3>
<p><br/></p>
<hr />
</div>
</div>
</div>
<div id="results" class="section level1">
<h1><span class="header-section-number">4</span> Results</h1>
<p><br/></p>
<div id="uk-biobank-1" class="section level2">
<h2><span class="header-section-number">4.1</span> UK Biobank</h2>
<details>
<p><summary>Plot per pT GeRS results</summary></p>
<pre class="bash"><code>#####
# Compare results across pTs for each phenotype
#####
module add apps/R/3.6.0
R

pheno&lt;-c(&#39;Depression&#39;,&#39;Intelligence&#39;,&#39;BMI&#39;,&#39;Height&#39;,&#39;T2D&#39;,&#39;CAD&#39;,&#39;IBD&#39;,&#39;RheuArth&#39;)
gwas&lt;-c(&#39;DEPR06&#39;,&#39;COLL01&#39;,&#39;BODY03&#39;,&#39;HEIG03&#39;,&#39;DIAB05&#39;,&#39;COAD01&#39;,&#39;CROH01&#39;,&#39;RHEU01&#39;)
weight=c(&#39;YFS.BLOOD.RNAARR&#39;)

res&lt;-NULL
for(i in 1:8){
  res_i&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withGeRSs/UKBB.w_hm3.&#39;,weight,&#39;.&#39;,gwas[i],&#39;.EUR-GeRSs.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  
  res_i$Phenotype&lt;-pheno[i]
  res_i&lt;-res_i[,c(&#39;Phenotype&#39;,&#39;Model&#39;,&#39;CrossVal_R&#39;,&#39;CrossVal_R_SE&#39;,&#39;IndepVal_R&#39;,&#39;IndepVal_R_SE&#39;)]
  res_i$Model&lt;-gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,res_i$Model))
  res_i$Model&lt;-factor(res_i$Model, levels=res_i$Model)
  
  res&lt;-rbind(res, res_i)
}

library(ggplot2)
library(cowplot)

res_plot_CrossVal&lt;-list()
for(i in 1:8){
  res_plot_CrossVal[[pheno[i]]]&lt;-ggplot(res[res$Phenotype == pheno[i],], aes(x=Model, y=CrossVal_R)) +
                                    geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
                                    labs(y=&#39;Correlation&#39;, x=&#39;pT&#39;, title=pheno[i])
}

bitmap(&#39;/mnt/lustre/users/k1806347/Analyses/UKBB_outcomes_for_prediction/GeRS_per_pT_CrossVal.png&#39;, units=&#39;px&#39;, res=300, width=4500, height=3000)
  plot_grid(plotlist=res_plot_CrossVal, ncol = 2)
dev.off()

res_plot_IndepVal&lt;-list()
for(i in 1:8){
  res_plot_IndepVal[[pheno[i]]]&lt;-ggplot(res[res$Phenotype == pheno[i],], aes(x=Model, y=IndepVal_R)) +
                                    geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
                                    labs(y=&#39;Correlation&#39;, x=&#39;pT&#39;, title=pheno[i])
}

bitmap(&#39;/mnt/lustre/users/k1806347/Analyses/UKBB_outcomes_for_prediction/GeRS_per_pT_IndepVal.png&#39;, units=&#39;px&#39;, res=300, width=4500, height=3000)
  plot_grid(plotlist=res_plot_IndepVal, ncol = 2)
dev.off()

q()
n
</code></pre>
</details>
<details>
<p><summary>Plot PRS vs. GeRS</summary></p>
<pre class="bash"><code>#####
# Compare results across pTs for each phenotype
#####
module add apps/R/3.6.0
R

pheno&lt;-c(&#39;Depression&#39;,&#39;Intelligence&#39;,&#39;BMI&#39;,&#39;Height&#39;,&#39;T2D&#39;,&#39;CAD&#39;,&#39;IBD&#39;,&#39;RheuArth&#39;)
gwas&lt;-c(&#39;DEPR06&#39;,&#39;COLL01&#39;,&#39;BODY03&#39;,&#39;HEIG03&#39;,&#39;DIAB05&#39;,&#39;COAD01&#39;,&#39;CROH01&#39;,&#39;RHEU01&#39;)

res&lt;-NULL
for(i in 1:8){
  GeRS_i&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withGeRSs/UKBB.w_hm3.AllTissue.&#39;,gwas[i],&#39;.EUR-GeRSs.pred_eval.txt&#39;), header=T, stringsAsFactors=F)
  GeRS_i&lt;-GeRS_i[dim(GeRS_i)[1],]
  GeRS_i$Model&lt;-&#39;AllTissue_GeRS&#39;
  GeRS_i&lt;-GeRS_i[,c(&#39;Model&#39;,&#39;CrossVal_R&#39;,&#39;CrossVal_R_SE&#39;,&#39;IndepVal_R&#39;,&#39;IndepVal_R_SE&#39;)]
  
  res_i$Phenotype&lt;-pheno[i]
  res_i&lt;-res_i[,c(&#39;Phenotype&#39;,&#39;Model&#39;,&#39;CrossVal_R&#39;,&#39;CrossVal_R_SE&#39;,&#39;IndepVal_R&#39;,&#39;IndepVal_R_SE&#39;)]
  res_i$Model&lt;-gsub(&#39;_group&#39;,&#39;&#39;,gsub(paste0(gwas[i],&#39;.&#39;),&#39;&#39;,res_i$Model))
  res_i$Model&lt;-factor(res_i$Model, levels=res_i$Model)
  
  res&lt;-rbind(res, res_i)
}

library(ggplot2)
library(cowplot)

res_plot_CrossVal&lt;-list()
for(i in 1:8){
  res_plot_CrossVal[[pheno[i]]]&lt;-ggplot(res[res$Phenotype == pheno[i],], aes(x=Model, y=CrossVal_R)) +
                                    geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
                                    labs(y=&#39;Correlation&#39;, x=&#39;pT&#39;, title=pheno[i])
}

bitmap(&#39;/mnt/lustre/users/k1806347/Analyses/UKBB_outcomes_for_prediction/GeRS_per_pT_CrossVal.png&#39;, units=&#39;px&#39;, res=300, width=4500, height=3000)
  plot_grid(plotlist=res_plot_CrossVal, ncol = 2)
dev.off()

res_plot_IndepVal&lt;-list()
for(i in 1:8){
  res_plot_IndepVal[[pheno[i]]]&lt;-ggplot(res[res$Phenotype == pheno[i],], aes(x=Model, y=IndepVal_R)) +
                                    geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
                                    labs(y=&#39;Correlation&#39;, x=&#39;pT&#39;, title=pheno[i])
}

bitmap(&#39;/mnt/lustre/users/k1806347/Analyses/UKBB_outcomes_for_prediction/GeRS_per_pT_IndepVal.png&#39;, units=&#39;px&#39;, res=300, width=4500, height=3000)
  plot_grid(plotlist=res_plot_IndepVal, ncol = 2)
dev.off()

q()
n
</code></pre>
</details>
<details>
<p><summary>Plot comparison results</summary></p>
<pre class="bash"><code>#####
# Compare results from each approach
#####
module add apps/R/3.6.0
R

pheno&lt;-c(&#39;Depression&#39;,&#39;Intelligence&#39;,&#39;BMI&#39;,&#39;Height&#39;,&#39;T2D&#39;,&#39;CAD&#39;,&#39;IBD&#39;,&#39;RheuArth&#39;)
gwas&lt;-c(&#39;DEPR06&#39;,&#39;COLL01&#39;,&#39;BODY03&#39;,&#39;HEIG03&#39;,&#39;DIAB05&#39;,&#39;COAD01&#39;,&#39;CROH01&#39;,&#39;RHEU01&#39;)
weight=c(&#39;YFS.BLOOD.RNAARR&#39;)

res&lt;-list()
for(i in 1:8){
res_1&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withGeRSs/UKBB.w_hm3.&#39;,weight,&#39;.&#39;,gwas[i],&#39;.EUR-GeRSs.pred_comp.txt&#39;), header=T, stringsAsFactors=F)
res_2&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withGeRSs/UKBB.w_hm3.AllTissue.&#39;,gwas[i],&#39;.EUR-GeRSs.pred_comp.txt&#39;), header=T, stringsAsFactors=F)
res_3&lt;-read.table(paste0(&#39;/users/k1806347/brc_scratch/Analyses/UKBB_outcomes_for_prediction/&#39;,pheno[i],&#39;/Association_withPRS_and_GeRSs/UKBB.w_hm3.AllTissue.&#39;,gwas[i],&#39;.EUR-GeRSs.EUR-PRSs.pt_clump.pred_comp.txt&#39;), header=T, stringsAsFactors=F)

res[[pheno[i]]]&lt;-data.frame(Test=c(&#39;GeRS_multi_pT&#39;,&#39;GeRS_multi_tissue&#39;,&#39;PRS_and_GeRS&#39;),     
                        do.call(rbind,list( res_1[res_1$Model_2_Cross_R == max(res_1$Model_2_Cross_R),],
                                                    res_2[res_2$Model_2_Cross_R == max(res_2$Model_2_Cross_R),],
                                                    res_3[2,])))
}

####
# Plot the R2 when using PRS only, and using PRS + multi-tissue GeRS
####

# Organise the results
res_plot&lt;-list()
for(i in 1:8){
tmp_res&lt;-res[[pheno[i]]]
tmp_res_Model_1&lt;-tmp_res[,grepl(&#39;Test|Model_1|Cross_R_diff|Indep_R_diff&#39;,names(tmp_res))]
names(tmp_res_Model_1)&lt;-c(&#39;Test&#39;,&#39;Model&#39;,&#39;Cross_R&#39;,&#39;Cross_R_diff&#39;,&#39;Cross_R_diff_pval&#39;,&#39;Indep_R&#39;,&#39;Indep_R_diff&#39;,&#39;Indep_R_diff_pval&#39;)
tmp_res_Model_2&lt;-tmp_res[,grepl(&#39;Test|Model_2|Cross_R_diff|Indep_R_diff&#39;,names(tmp_res))]
names(tmp_res_Model_2)&lt;-c(&#39;Test&#39;,&#39;Model&#39;,&#39;Cross_R&#39;,&#39;Cross_R_diff&#39;,&#39;Cross_R_diff_pval&#39;,&#39;Indep_R&#39;,&#39;Indep_R_diff&#39;,&#39;Indep_R_diff_pval&#39;)
tmp_res_Model_2$Cross_R_diff&lt;-NA
tmp_res_Model_2$Cross_R_diff_pval&lt;-NA
tmp_res_Model_2$Indep_R_diff&lt;-NA
tmp_res_Model_2$Indep_R_diff_pval&lt;-NA

tmp_res_plot&lt;-rbind(tmp_res_Model_1,tmp_res_Model_2)
tmp_res_plot$Phenotype&lt;-pheno[i]

res_plot[[pheno[i]]]&lt;-tmp_res_plot
}

# Combine results for each phenotype and prepare for plotting
All_res_plot&lt;-do.call(rbind, res_plot)

All_res_plot$Test&lt;-factor(All_res_plot$Test, levels=res[[1]]$Test)
All_res_plot$Phenotype&lt;-factor(All_res_plot$Phenotype, level=unique(All_res_plot$Phenotype))
All_res_plot&lt;-All_res_plot[order(All_res_plot$Phenotype,All_res_plot$Test),]
All_res_plot$Cross_Val_Label&lt;-NA
All_res_plot$Cross_Val_Label[!is.na(All_res_plot$Cross_R_diff)]&lt;-paste0(&#39;Diff = &#39;,round(All_res_plot$Cross_R_diff[!is.na(All_res_plot$Cross_R_diff)],3), &#39;\np = &#39;,All_res_plot$Cross_R_diff_pval[!is.na(All_res_plot$Cross_R_diff)])

All_res_plot$Indep_Val_Label&lt;-NA
All_res_plot$Indep_Val_Label[!is.na(All_res_plot$Indep_R_diff)]&lt;-paste0(&#39;Diff = &#39;,round(All_res_plot$Indep_R_diff[!is.na(All_res_plot$Indep_R_diff)],3), &#39;\np = &#39;,All_res_plot$Indep_R_diff_pval[!is.na(All_res_plot$Indep_R_diff)])

All_res_plot$Model[!All_res_plot$Model == &#39;Full_model&#39; &amp; All_res_plot$Test == &#39;GeRS_multi_pT&#39;]&lt;-&#39;GeRS Best pT   &#39;
All_res_plot$Model[All_res_plot$Model == &#39;Full_model&#39; &amp; All_res_plot$Test == &#39;GeRS_multi_pT&#39;]&lt;-&#39;GeRS Multi pT&#39;

All_res_plot$Model[!All_res_plot$Model == &#39;Full_model&#39; &amp; All_res_plot$Test == &#39;GeRS_multi_tissue&#39;]&lt;-&#39;GeRS Best Tissue   &#39;
All_res_plot$Model[All_res_plot$Model == &#39;Full_model&#39; &amp; All_res_plot$Test == &#39;GeRS_multi_tissue&#39;]&lt;-&#39;GeRS Multi Tissue&#39;

All_res_plot$Model[!All_res_plot$Model == &#39;Full_model&#39; &amp; All_res_plot$Test == &#39;PRS_and_GeRS&#39;]&lt;-&#39;PRS only   &#39;
All_res_plot$Model[All_res_plot$Model == &#39;Full_model&#39; &amp; All_res_plot$Test == &#39;PRS_and_GeRS&#39;]&lt;-&#39;PRS + GeRS&#39;

All_res_plot$Model&lt;-factor(All_res_plot$Model, levels=c(&quot;GeRS Best pT   &quot;,&quot;GeRS Multi pT&quot;, &quot;GeRS Best Tissue   &quot;,&quot;GeRS Multi Tissue&quot;,&quot;PRS only   &quot;,&quot;PRS + GeRS&quot;))

library(ggplot2)
library(cowplot)
# Plot cross validation results
Plot_1&lt;-ggplot(All_res_plot[All_res_plot$Test == &#39;GeRS_multi_pT&#39;,], aes(x=Phenotype, y=Cross_R, fill=Model, label=Cross_Val_Label)) +
          geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
          geom_text(aes(y=Cross_R+0.04)) +
          labs(y=&#39;Correlation&#39;, x=&#39;&#39;) +
          ylim(0,0.4) +
          theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position=&quot;top&quot;, legend.justification = c(0.5, 0), legend.title=element_blank()) +
          guides(fill=guide_legend(title.hjust =0.5))

Plot_2&lt;-ggplot(All_res_plot[All_res_plot$Test == &#39;GeRS_multi_tissue&#39;,], aes(x=Phenotype, y=Cross_R, fill=Model, label=Cross_Val_Label)) +
          geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
          geom_text(aes(y=Cross_R+0.04)) +
          labs(y=&#39;Correlation&#39;, x=&#39;&#39;) +
          ylim(0,0.4) +
          theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position=&quot;top&quot;, legend.justification = c(0.5, 0), legend.title=element_blank()) +
          guides(fill=guide_legend(title.hjust =0.5))

Plot_3&lt;-ggplot(All_res_plot[All_res_plot$Test == &#39;PRS_and_GeRS&#39;,], aes(x=Phenotype, y=Cross_R, fill=Model, label=Cross_Val_Label)) +
          geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
          geom_text(aes(y=Cross_R+0.04)) +
          labs(y=&#39;Correlation&#39;, x=&#39;&#39;) +
          theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position=&quot;top&quot;, legend.justification = c(0.5, 0), legend.title=element_blank()) +
          ylim(0,0.4) +
          guides(fill=guide_legend(title.hjust =0.5))


bitmap(&#39;/mnt/lustre/users/k1806347/Analyses/UKBB_outcomes_for_prediction/GeRS_tests_summary_CrossVal.png&#39;, units=&#39;px&#39;, res=300, width=4500, height=3000)
  plot_grid(Plot_1,Plot_2,Plot_3, labels = &quot;AUTO&quot;)
dev.off()

# Plot independent validation results
Plot_1&lt;-ggplot(All_res_plot[All_res_plot$Test == &#39;GeRS_multi_pT&#39;,], aes(x=Phenotype, y=Indep_R, fill=Model, label=Indep_Val_Label)) +
          geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
          geom_text(aes(y=Indep_R+0.04)) +
          labs(y=&#39;Correlation&#39;, x=&#39;&#39;) +
          ylim(0,0.4) +
          theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position=&quot;top&quot;, legend.justification = c(0.5, 0), legend.title=element_blank()) +
          guides(fill=guide_legend(title.hjust =0.5))

Plot_2&lt;-ggplot(All_res_plot[All_res_plot$Test == &#39;GeRS_multi_tissue&#39;,], aes(x=Phenotype, y=Indep_R, fill=Model, label=Indep_Val_Label)) +
          geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
          geom_text(aes(y=Indep_R+0.04)) +
          labs(y=&#39;Correlation&#39;, x=&#39;&#39;) +
          ylim(0,0.4) +
          theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position=&quot;top&quot;, legend.justification = c(0.5, 0), legend.title=element_blank()) +
          guides(fill=guide_legend(title.hjust =0.5))

Plot_3&lt;-ggplot(All_res_plot[All_res_plot$Test == &#39;PRS_and_GeRS&#39;,], aes(x=Phenotype, y=Indep_R, fill=Model, label=Indep_Val_Label)) +
          geom_bar(stat=&quot;identity&quot;, position=position_dodge(), colour=&#39;black&#39;) +
          geom_text(aes(y=Indep_R+0.04)) +
          labs(y=&#39;Correlation&#39;, x=&#39;&#39;) +
          ylim(0,0.4) +
          theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position=&quot;top&quot;, legend.justification = c(0.5, 0), legend.title=element_blank()) +
          guides(fill=guide_legend(title.hjust =0.5))

bitmap(&#39;/mnt/lustre/users/k1806347/Analyses/UKBB_outcomes_for_prediction/GeRS_tests_summary_IndepVal.png&#39;, units=&#39;px&#39;, res=300, width=4500, height=3000)
  plot_grid(Plot_1,Plot_2,Plot_3, labels = &quot;AUTO&quot;)
dev.off()

q()
n
</code></pre>
</details>
<p><br/></p>
</div>
<div id="teds-1" class="section level2">
<h2><span class="header-section-number">4.2</span> TEDS</h2>
<details>
<p><summary>Code for plotting results</summary></p>
<pre class="bash"><code></code></pre>
</details>
<p><br/></p>
<hr />
</div>
<div id="summary-of-results" class="section level2">
<h2><span class="header-section-number">4.3</span> Summary of results</h2>
<p>Here we will estimate the average correlation between observed and predicted values across all phenotypes.</p>
<details>
<p><summary>Average results across phenotypes</summary></p>
<hr />
</div>
</div>
<div id="conclusion" class="section level1">
<h1><span class="header-section-number">5</span> Conclusion</h1>
<p><br/></p>
<hr />
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
